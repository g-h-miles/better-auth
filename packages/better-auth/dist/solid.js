import{createFetch as Q}from"@better-fetch/fetch";var P=Object.create(null),m=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?P:globalThis),g=new Proxy(P,{get(e,t){return m()[t]??P[t]},has(e,t){let n=m();return t in n||t in P},set(e,t,n){let c=m(!0);return c[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=m(!0);return delete n[t],!0},ownKeys(){let e=m(!0);return Object.keys(e)}});function j(e){return e?e!=="false":!1}var D=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var re=D==="test"||j(g.TEST);var S=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function V(e){try{return new URL(e).pathname!=="/"}catch{throw new S(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function b(e,t="/api/auth"){return V(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function E(e,t){if(e)return b(e,t);let n=g.BETTER_AUTH_URL||g.NEXT_PUBLIC_BETTER_AUTH_URL||g.PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_AUTH_URL||(g.BASE_URL!=="/"?g.BASE_URL:void 0);if(n)return b(n,t);if(typeof window<"u"&&window.location)return b(window.location.origin,t)}import"nanostores";import"@better-fetch/fetch";var w={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},_={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};import{atom as M}from"nanostores";import"@better-fetch/fetch";import{atom as q,onMount as H}from"nanostores";var U=(e,t,n,c)=>{let r=q({data:null,error:null,isPending:!0,isRefetching:!1}),p=()=>{let l=typeof c=="function"?c({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):c;return n(t,{...l,async onSuccess(f){typeof window<"u"&&r.set({data:f.data,error:null,isPending:!1,isRefetching:!1}),await l?.onSuccess?.(f)},async onError(f){r.set({error:f.error,data:null,isPending:!1,isRefetching:!1}),await l?.onError?.(f)},async onRequest(f){let i=r.get();r.set({isPending:i.data===null,data:i.data,error:null,isRefetching:!0}),await l?.onRequest?.(f)}})};e=Array.isArray(e)?e:[e];let a=!1;for(let l of e)l.subscribe(()=>{a?p():H(r,()=>(p(),a=!0,()=>{r.off(),l.off()}))});return r};function I(e){let t=M(!1);return{session:U(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var W={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},G=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,x={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},J=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function z(e){return e instanceof Date&&!isNaN(e.getTime())}function X(e){let t=J.exec(e);if(!t)return null;let[,n,c,r,p,a,l,f,i,s,u]=t,d=new Date(Date.UTC(parseInt(n,10),parseInt(c,10)-1,parseInt(r,10),parseInt(p,10),parseInt(a,10),parseInt(l,10),f?parseInt(f.padEnd(3,"0"),10):0));if(i){let o=(parseInt(s,10)*60+parseInt(u,10))*(i==="+"?-1:1);d.setUTCMinutes(d.getUTCMinutes()+o)}return z(d)?d:null}function K(e,t={}){let{strict:n=!1,warnings:c=!1,reviver:r,parseDates:p=!0}=t;if(typeof e!="string")return e;let a=e.trim();if(a[0]==='"'&&a.endsWith('"')&&!a.slice(1,-1).includes('"'))return a.slice(1,-1);let l=a.toLowerCase();if(l.length<=9&&l in x)return x[l];if(!G.test(a)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(W).some(([i,s])=>{let u=s.test(a);return u&&c&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),u})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(a,(s,u)=>{if(s==="__proto__"||s==="constructor"&&u&&typeof u=="object"&&"prototype"in u){c&&console.warn(`[better-json] Dropping "${s}" key to prevent prototype pollution`);return}if(p&&typeof u=="string"){let d=X(u);if(d)return d}return r?r(s,u):u})}catch(i){if(n)throw i;return e}}function v(e,t={strict:!0}){return K(e,t)}var B=e=>{let t="credentials"in Request.prototype,n=E(e?.baseURL),c=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=Q({baseURL:n,...t?{credentials:"include"}:{},method:"GET",jsonParser(o){return v(o,{strict:!1})},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...c]:[w,_,...e?.fetchOptions?.plugins||[],...c]}),{$sessionSignal:p,session:a}=I(r),l=e?.plugins||[],f={},i={$sessionSignal:p,session:a},s={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},u=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of l)o.getAtoms&&Object.assign(i,o.getAtoms?.(r)),o.pathMethods&&Object.assign(s,o.pathMethods),o.atomListeners&&u.push(...o.atomListeners);let d={notify:o=>{i[o].set(!i[o].get())},listen:(o,T)=>{i[o].subscribe(T)},atoms:i};for(let o of l)o.getActions&&Object.assign(f,o.getActions?.(r,d));return{pluginsActions:f,pluginsAtoms:i,pluginPathMethods:s,atomListeners:u,$fetch:r,$store:d}};function Y(e,t,n){let c=t[e],{fetchOptions:r,query:p,...a}=n||{};return c||(r?.method?r.method:a&&Object.keys(a).length>0?"POST":"GET")}function L(e,t,n,c,r){function p(a=[]){return new Proxy(function(){},{get(l,f){let i=[...a,f],s=e;for(let u of i)if(s&&typeof s=="object"&&u in s)s=s[u];else{s=void 0;break}return typeof s=="function"?s:p(i)},apply:async(l,f,i)=>{let s="/"+a.map(R=>R.replace(/[A-Z]/g,h=>`-${h.toLowerCase()}`)).join("/"),u=i[0]||{},d=i[1]||{},{query:o,fetchOptions:T,...k}=u,y={...d,...T},A=Y(s,n,u);return await t(s,{...y,body:A==="GET"?void 0:{...k,...y?.body||{}},query:o||y?.query,method:A,async onSuccess(R){await y?.onSuccess?.(R);let h=r?.find($=>$.matcher(s));if(!h)return;let O=c[h.signal];if(!O)return;let N=O.get();setTimeout(()=>{O.set(!N)},10)}})}})}return p()}function C(e){return e.charAt(0).toUpperCase()+e.slice(1)}import{createStore as Z,reconcile as ee}from"solid-js/store";import{onCleanup as te}from"solid-js";function F(e){let t=e.listen(()=>{}),[n,c]=Z({value:e.get()}),r=e.subscribe(p=>{c("value",ee(p))});return te(()=>r()),t(),()=>n.value}function ne(e){return`use${C(e)}`}function Fe(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:c,$fetch:r,atomListeners:p}=B(e),a={};for(let[i,s]of Object.entries(c))a[ne(i)]=()=>F(s);let l={...n,...a};return L(l,r,t,c,p)}export{Fe as createAuthClient};
