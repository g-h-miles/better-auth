"use strict";var w=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var J=(e,t)=>{for(var n in t)w(e,n,{get:t[n],enumerable:!0})},z=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of W(t))!G.call(e,r)&&r!==n&&w(e,r,{get:()=>t[r],enumerable:!(s=M(t,r))||s.enumerable});return e};var X=e=>z(w({},"__esModule",{value:!0}),e);var ue={};J(ue,{createAuthClient:()=>ce});module.exports=X(ue);var g=require("vue");function K(e){let t=(0,g.getCurrentInstance)();if(t&&t.proxy){let n=t.proxy;("_nanostores"in n?n._nanostores:n._nanostores=[]).push(e)}}function _(e){let t=(0,g.shallowRef)(),n=e.subscribe(s=>{t.value=s});return(0,g.getCurrentScope)()&&(0,g.onScopeDispose)(n),process.env.NODE_ENV!=="production"?(K(e),(0,g.readonly)(t)):t}var D=require("@better-fetch/fetch");var T=Object.create(null),m=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?T:globalThis),y=new Proxy(T,{get(e,t){return m()[t]??T[t]},has(e,t){let n=m();return t in n||t in T},set(e,t,n){let s=m(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=m(!0);return delete n[t],!0},ownKeys(){let e=m(!0);return Object.keys(e)}});function Q(e){return e?e!=="false":!1}var Y=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var pe=Y==="test"||Q(y.TEST);var b=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function Z(e){try{return new URL(e).pathname!=="/"}catch{throw new b(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function U(e,t="/api/auth"){return Z(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function I(e,t){if(e)return U(e,t);let n=y.BETTER_AUTH_URL||y.NEXT_PUBLIC_BETTER_AUTH_URL||y.PUBLIC_BETTER_AUTH_URL||y.NUXT_PUBLIC_BETTER_AUTH_URL||y.NUXT_PUBLIC_AUTH_URL||(y.BASE_URL!=="/"?y.BASE_URL:void 0);if(n)return U(n,t);if(typeof window<"u"&&window.location)return U(window.location.origin,t)}var _e=require("nanostores");var Re=require("@better-fetch/fetch"),L={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},v={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var C=require("nanostores");var Se=require("@better-fetch/fetch"),O=require("nanostores"),B=(e,t,n,s)=>{let r=(0,O.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),d=()=>{let l=typeof s=="function"?s({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):s;return n(t,{...l,async onSuccess(f){typeof window<"u"&&r.set({data:f.data,error:null,isPending:!1,isRefetching:!1}),await l?.onSuccess?.(f)},async onError(f){r.set({error:f.error,data:null,isPending:!1,isRefetching:!1}),await l?.onError?.(f)},async onRequest(f){let a=r.get();r.set({isPending:a.data===null,data:a.data,error:null,isRefetching:!0}),await l?.onRequest?.(f)}})};e=Array.isArray(e)?e:[e];let u=!1;for(let l of e)l.subscribe(()=>{u?d():(0,O.onMount)(r,()=>(d(),u=!0,()=>{r.off(),l.off()}))});return r};function F(e){let t=(0,C.atom)(!1);return{session:B(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var ee={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},te=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,N={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},ne=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function re(e){return e instanceof Date&&!isNaN(e.getTime())}function oe(e){let t=ne.exec(e);if(!t)return null;let[,n,s,r,d,u,l,f,a,c,i]=t,p=new Date(Date.UTC(parseInt(n,10),parseInt(s,10)-1,parseInt(r,10),parseInt(d,10),parseInt(u,10),parseInt(l,10),f?parseInt(f.padEnd(3,"0"),10):0));if(a){let o=(parseInt(c,10)*60+parseInt(i,10))*(a==="+"?-1:1);p.setUTCMinutes(p.getUTCMinutes()+o)}return re(p)?p:null}function se(e,t={}){let{strict:n=!1,warnings:s=!1,reviver:r,parseDates:d=!0}=t;if(typeof e!="string")return e;let u=e.trim();if(u[0]==='"'&&u.endsWith('"')&&!u.slice(1,-1).includes('"'))return u.slice(1,-1);let l=u.toLowerCase();if(l.length<=9&&l in N)return N[l];if(!te.test(u)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(ee).some(([a,c])=>{let i=c.test(u);return i&&s&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${a} pattern`),i})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(u,(c,i)=>{if(c==="__proto__"||c==="constructor"&&i&&typeof i=="object"&&"prototype"in i){s&&console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);return}if(d&&typeof i=="string"){let p=oe(i);if(p)return p}return r?r(c,i):i})}catch(a){if(n)throw a;return e}}function $(e,t={strict:!0}){return se(e,t)}var k=e=>{let t="credentials"in Request.prototype,n=I(e?.baseURL),s=e?.plugins?.flatMap(o=>o.fetchPlugins).filter(o=>o!==void 0)||[],r=(0,D.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",jsonParser(o){return $(o,{strict:!1})},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[L,v,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:d,session:u}=F(r),l=e?.plugins||[],f={},a={$sessionSignal:d,session:u},c={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},i=[{signal:"$sessionSignal",matcher(o){return o==="/sign-out"||o==="/update-user"||o.startsWith("/sign-in")||o.startsWith("/sign-up")}}];for(let o of l)o.getAtoms&&Object.assign(a,o.getAtoms?.(r)),o.pathMethods&&Object.assign(c,o.pathMethods),o.atomListeners&&i.push(...o.atomListeners);let p={notify:o=>{a[o].set(!a[o].get())},listen:(o,h)=>{a[o].subscribe(h)},atoms:a};for(let o of l)o.getActions&&Object.assign(f,o.getActions?.(r,p));return{pluginsActions:f,pluginsAtoms:a,pluginPathMethods:c,atomListeners:i,$fetch:r,$store:p}};function j(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ie(e,t,n){let s=t[e],{fetchOptions:r,query:d,...u}=n||{};return s||(r?.method?r.method:u&&Object.keys(u).length>0?"POST":"GET")}function V(e,t,n,s,r){function d(u=[]){return new Proxy(function(){},{get(l,f){let a=[...u,f],c=e;for(let i of a)if(c&&typeof c=="object"&&i in c)c=c[i];else{c=void 0;break}return typeof c=="function"?c:d(a)},apply:async(l,f,a)=>{let c="/"+u.map(A=>A.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),i=a[0]||{},p=a[1]||{},{query:o,fetchOptions:h,...R}=i,P={...p,...h},x=ie(c,n,i);return await t(c,{...P,body:x==="GET"?void 0:{...R,...P?.body||{}},query:o||P?.query,method:x,async onSuccess(A){await P?.onSuccess?.(A);let S=r?.find(H=>H.matcher(c));if(!S)return;let E=s[S.signal];if(!E)return;let q=E.get();setTimeout(()=>{E.set(!q)},10)}})}})}return d()}function ae(e){return`use${j(e)}`}function ce(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:r,$store:d,atomListeners:u}=k(e),l={};for(let[i,p]of Object.entries(s))l[ae(i)]=()=>_(p);function f(i){if(i){let p=_(s.$sessionSignal),o=e?.fetchOptions?.baseURL||e?.baseURL,h=o?new URL(o).pathname:"/api/auth";return i(`${h}/get-session`,{ref:p}).then(R=>({data:R.data,isPending:!1,error:R.error}))}return l.useSession()}let a={...n,...l,useSession:f,$fetch:r,$store:d};return V(a,r,t,s,u)}0&&(module.exports={createAuthClient});
