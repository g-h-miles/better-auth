var F=Object.defineProperty;var t=(e,a)=>F(e,"name",{value:a,configurable:!0});import{z as n}from"zod";import{APIError as W}from"better-call";var J=n.object({id:n.string(),providerId:n.string(),accountId:n.string(),userId:n.string(),accessToken:n.string().nullish(),refreshToken:n.string().nullish(),idToken:n.string().nullish(),accessTokenExpiresAt:n.date().nullish(),refreshTokenExpiresAt:n.date().nullish(),scope:n.string().nullish(),password:n.string().nullish(),createdAt:n.date().default(()=>new Date),updatedAt:n.date().default(()=>new Date)}),z=n.object({id:n.string(),email:n.string().transform(e=>e.toLowerCase()),emailVerified:n.boolean().default(!1),name:n.string(),image:n.string().nullish(),createdAt:n.date().default(()=>new Date),updatedAt:n.date().default(()=>new Date)}),G=n.object({id:n.string(),userId:n.string(),expiresAt:n.date(),createdAt:n.date().default(()=>new Date),updatedAt:n.date().default(()=>new Date),token:n.string(),ipAddress:n.string().nullish(),userAgent:n.string().nullish()}),Z=n.object({id:n.string(),value:n.string(),createdAt:n.date().default(()=>new Date),updatedAt:n.date().default(()=>new Date),expiresAt:n.date(),identifier:n.string()});var x=Object.create(null),g=t(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?x:globalThis),"_getEnv"),k=new Proxy(x,{get(e,a){return g()[a]??x[a]},has(e,a){let f=g();return a in f||a in x},set(e,a,f){let l=g(!0);return l[a]=f,!0},deleteProperty(e,a){if(!a)return!1;let f=g(!0);return delete f[a],!0},ownKeys(){let e=g(!0);return Object.keys(e)}});function O(e){return e?e!=="false":!1}t(O,"toBoolean");var D=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var I=D==="test"||O(k.TEST);import{createRandomStringGenerator as N}from"@better-auth/utils/random";var w=t(e=>N("a-z","A-Z","0-9")(e||32),"generateId");import{z as et}from"zod";import{APIError as rt}from"better-call";import{createHash as Ve}from"@better-auth/utils/hash";import{xchacha20poly1305 as Me}from"@noble/ciphers/chacha";import{bytesToHex as Ce,hexToBytes as je,utf8ToBytes as $e}from"@noble/ciphers/utils";import{managedNonce as He}from"@noble/ciphers/webcrypto";import{scryptAsync as Oe}from"@noble/hashes/scrypt";import{getRandomValues as Ie}from"uncrypto";import{hex as Ue}from"@better-auth/utils/hex";import{createRandomStringGenerator as S}from"@better-auth/utils/random";var q=S("a-z","0-9","A-Z","-_");var b=["info","success","warn","error","debug"];function L(e,a){return b.indexOf(a)<=b.indexOf(e)}t(L,"shouldPublishLog");var m={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},B={info:m.fg.blue,success:m.fg.green,warn:m.fg.yellow,error:m.fg.red,debug:m.fg.magenta},E=t((e,a)=>{let f=new Date().toISOString();return`${m.dim}${f}${m.reset} ${B[e]}${e.toUpperCase()}${m.reset} ${m.bright}Better Auth${m.reset} ${a}`},"formatMessage"),R=t(e=>{let a=e?.disabled!==!0,f=e?.level??"error",l=t((o,p,r=[])=>{if(!a||!L(f,o))return;let s=E(o,p);if(!e||typeof e.log!="function"){o==="error"?console.error(s,...r):o==="warn"?console.warn(s,...r):console.log(s,...r);return}e.log(o==="success"?"info":o,s,...r)},"LogFunc");return Object.fromEntries(b.map(o=>[o,(...[p,...r])=>l(o,p,r)]))},"createLogger"),V=R();var A=t(e=>{let a=e.plugins?.reduce((i,u)=>{let c=u.schema;if(!c)return i;for(let[d,y]of Object.entries(c))i[d]={fields:{...i[d]?.fields,...y.fields},modelName:y.modelName||d};return i},{}),f=e.rateLimit?.storage==="database",l={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:o,session:p,account:r,...s}=a||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:t(()=>!1,"defaultValue"),required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:t(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:t(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...o?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...p?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...r?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:t(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:t(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...s,...f?l:{}}},"getAuthTables");import{z as Et}from"zod";import{Kysely as _t,MssqlDialect as Ct}from"kysely";import{MysqlDialect as $t,PostgresDialect as Kt,SqliteDialect as Ht}from"kysely";function v(e,a,f){return f==="update"?e:e==null&&a.defaultValue?typeof a.defaultValue=="function"?a.defaultValue():a.defaultValue:e}t(v,"withApplyDefault");var _=t(e=>{let a=A(e);function f(l,o){return o==="id"?o:a[l].fields[o].fieldName||o}return t(f,"getField"),{transformInput(l,o,p){let r=p==="update"?{}:{id:e.advanced?.generateId?e.advanced.generateId({model:o}):l.id||w()},s=a[o].fields;for(let i in s){let u=l[i];u===void 0&&!s[i].defaultValue||(r[s[i].fieldName||i]=v(u,s[i],p))}return r},transformOutput(l,o,p=[]){if(!l)return null;let r=l.id||l._id?p.length===0||p.includes("id")?{id:l.id}:{}:{},s=a[o].fields;for(let i in s){if(p.length&&!p.includes(i))continue;let u=s[i];u&&(r[i]=l[u.fieldName||i])}return r},convertWhereClause(l,o,p){return o.filter(r=>l.every(s=>{let{field:i,value:u,operator:c}=s,d=f(p,i);if(c==="in"){if(!Array.isArray(u))throw new Error("Value must be an array");return u.includes(r[d])}else return c==="contains"?r[d].includes(u):c==="starts_with"?r[d].startsWith(u):c==="ends_with"?r[d].endsWith(u):r[d]===u}))},getField:f}},"createTransform"),M=t(e=>a=>{let{transformInput:f,transformOutput:l,convertWhereClause:o,getField:p}=_(a);return{id:"memory",create:t(async({model:r,data:s})=>{let i=f(s,r,"create");return e[r].push(i),l(i,r)},"create"),findOne:t(async({model:r,where:s,select:i})=>{let u=e[r],d=o(s,u,r)[0]||null;return l(d,r,i)},"findOne"),findMany:t(async({model:r,where:s,sortBy:i,limit:u,offset:c})=>{let d=e[r];return s&&(d=o(s,d,r)),i&&(d=d.sort((y,T)=>{let h=p(r,i.field);return i.direction==="asc"?y[h]>T[h]?1:-1:y[h]<T[h]?1:-1})),c!==void 0&&(d=d.slice(c)),u!==void 0&&(d=d.slice(0,u)),d.map(y=>l(y,r))},"findMany"),update:t(async({model:r,where:s,update:i})=>{let u=e[r],c=o(s,u,r);return c.forEach(d=>{Object.assign(d,f(i,r,"update"))}),l(c[0],r)},"update"),delete:t(async({model:r,where:s})=>{let i=e[r],u=o(s,i,r);e[r]=i.filter(c=>!u.includes(c))},"delete"),deleteMany:t(async({model:r,where:s})=>{let i=e[r],u=o(s,i,r),c=0;return e[r]=i.filter(d=>u.includes(d)?(c++,!1):!u.includes(d)),c},"deleteMany"),updateMany(r){let{model:s,where:i,update:u}=r,c=e[s],d=o(i,c,s);return d.forEach(y=>{Object.assign(y,u)}),d[0]||null}}},"memoryAdapter");export{M as memoryAdapter};
