"use strict";var R=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var M=(e,n)=>{for(var d in n)R(e,d,{get:n[d],enumerable:!0})},V=(e,n,d,u)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of P(n))!E.call(e,c)&&c!==d&&R(e,c,{get:()=>n[c],enumerable:!(u=L(n,c))||u.enumerable});return e};var C=e=>V(R({},"__esModule",{value:!0}),e);var de={};M(de,{prismaAdapter:()=>oe});module.exports=C(de);var s=require("zod"),_=require("better-call"),fe=s.z.object({id:s.z.string(),providerId:s.z.string(),accountId:s.z.string(),userId:s.z.string(),accessToken:s.z.string().nullish(),refreshToken:s.z.string().nullish(),idToken:s.z.string().nullish(),accessTokenExpiresAt:s.z.date().nullish(),refreshTokenExpiresAt:s.z.date().nullish(),scope:s.z.string().nullish(),password:s.z.string().nullish(),createdAt:s.z.date().default(()=>new Date),updatedAt:s.z.date().default(()=>new Date)}),pe=s.z.object({id:s.z.string(),email:s.z.string().transform(e=>e.toLowerCase()),emailVerified:s.z.boolean().default(!1),name:s.z.string(),image:s.z.string().nullish(),createdAt:s.z.date().default(()=>new Date),updatedAt:s.z.date().default(()=>new Date)}),me=s.z.object({id:s.z.string(),userId:s.z.string(),expiresAt:s.z.date(),createdAt:s.z.date().default(()=>new Date),updatedAt:s.z.date().default(()=>new Date),token:s.z.string(),ipAddress:s.z.string().nullish(),userAgent:s.z.string().nullish()}),ye=s.z.object({id:s.z.string(),value:s.z.string(),createdAt:s.z.date().default(()=>new Date),updatedAt:s.z.date().default(()=>new Date),expiresAt:s.z.date(),identifier:s.z.string()});var T=Object.create(null),b=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?T:globalThis),D=new Proxy(T,{get(e,n){return b()[n]??T[n]},has(e,n){let d=b();return n in d||n in T},set(e,n,d){let u=b(!0);return u[n]=d,!0},deleteProperty(e,n){if(!n)return!1;let d=b(!0);return delete d[n],!0},ownKeys(){let e=b(!0);return Object.keys(e)}});function $(e){return e?e!=="false":!1}var j=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var K=j==="test"||$(D.TEST);var N=require("@better-auth/utils/random"),v=e=>(0,N.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32);var X=require("zod"),Y=require("better-call");var A=class extends Error{constructor(n,d){super(n),this.name="BetterAuthError",this.message=n,this.cause=d,this.stack=""}};var z=require("@better-auth/utils/hash"),Z=require("@noble/ciphers/chacha"),O=require("@noble/ciphers/utils"),Q=require("@noble/ciphers/webcrypto");var H=require("@noble/hashes/scrypt"),W=require("uncrypto"),J=require("@better-auth/utils/hex");var U=require("@better-auth/utils/random"),G=(0,U.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var I=["info","success","warn","error","debug"];function ee(e,n){return I.indexOf(n)<=I.indexOf(e)}var h={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},te={info:h.fg.blue,success:h.fg.green,warn:h.fg.yellow,error:h.fg.red,debug:h.fg.magenta},re=(e,n)=>{let d=new Date().toISOString();return`${h.dim}${d}${h.reset} ${te[e]}${e.toUpperCase()}${h.reset} ${h.bright}Better Auth${h.reset} ${n}`},q=e=>{let n=e?.disabled!==!0,d=e?.level??"error",u=(c,y,f=[])=>{if(!n||!ee(d,c))return;let a=re(c,y);if(!e||typeof e.log!="function"){c==="error"?console.error(a,...f):c==="warn"?console.warn(a,...f):console.log(a,...f);return}e.log(c==="success"?"info":c,a,...f)};return Object.fromEntries(I.map(c=>[c,(...[y,...f])=>u(c,y,f)]))},ne=q();var w=e=>{let n=e.plugins?.reduce((i,p)=>{let l=p.schema;if(!l)return i;for(let[t,o]of Object.entries(l))i[t]={fields:{...i[t]?.fields,...o.fields},modelName:o.modelName||t};return i},{}),d=e.rateLimit?.storage==="database",u={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:c,session:y,account:f,...a}=n||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...c?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...y?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...f?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...a,...d?u:{}}};var se=require("zod");var S=require("kysely"),F=require("kysely");function k(e,n,d){return d==="update"?e:e==null&&n.defaultValue?typeof n.defaultValue=="function"?n.defaultValue():n.defaultValue:e}var ae=(e,n)=>{let d=w(n);function u(a,i){return i==="id"?i:d[a].fields[i].fieldName||i}function c(a){switch(a){case"starts_with":return"startsWith";case"ends_with":return"endsWith";default:return a}}function y(a){return d[a].modelName}let f=n?.advanced?.generateId===!1;return{transformInput(a,i,p){let l=f||p==="update"?{}:{id:n.advanced?.generateId?n.advanced.generateId({model:i}):a.id||v()},t=d[i].fields;for(let o in t){let r=a[o];r===void 0&&(!t[o].defaultValue||p==="update")||(l[t[o].fieldName||o]=k(r,t[o],p))}return l},transformOutput(a,i,p=[]){if(!a)return null;let l=a.id||a._id?p.length===0||p.includes("id")?{id:a.id}:{}:{},t=d[i].fields;for(let o in t){if(p.length&&!p.includes(o))continue;let r=t[o];r&&(l[o]=a[r.fieldName||o])}return l},convertWhereClause(a,i){if(!i)return{};if(i.length===1){let r=i[0];return r?{[u(a,r.field)]:r.operator==="eq"||!r.operator?r.value:{[c(r.operator)]:r.value}}:void 0}let p=i.filter(r=>r.connector==="AND"||!r.connector),l=i.filter(r=>r.connector==="OR"),t=p.map(r=>({[u(a,r.field)]:r.operator==="eq"||!r.operator?r.value:{[c(r.operator)]:r.value}})),o=l.map(r=>({[u(a,r.field)]:{[r.operator||"eq"]:r.value}}));return{...t.length?{AND:t}:{},...o.length?{OR:o}:{}}},convertSelect:(a,i)=>{if(!(!a||!i))return a.reduce((p,l)=>({...p,[u(i,l)]:!0}),{})},getModelName:y,getField:u}},oe=(e,n)=>d=>{let u=e,{transformInput:c,transformOutput:y,convertWhereClause:f,convertSelect:a,getModelName:i,getField:p}=ae(n,d);return{id:"prisma",async create(l){let{model:t,data:o,select:r}=l,m=c(o,t,"create");if(!u[i(t)])throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let g=await u[i(t)].create({data:m,select:a(r,t)});return y(g,t,r)},async findOne(l){let{model:t,where:o,select:r}=l,m=f(t,o);if(!u[i(t)])throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let g=await u[i(t)].findFirst({where:m,select:a(r,t)});return y(g,t,r)},async findMany(l){let{model:t,where:o,limit:r,offset:m,sortBy:g}=l,x=f(t,o);if(!u[i(t)])throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return(await u[i(t)].findMany({where:x,take:r||100,skip:m||0,...g?.field?{orderBy:{[p(t,g.field)]:g.direction==="desc"?"desc":"asc"}}:{}})).map(B=>y(B,t))},async update(l){let{model:t,where:o,update:r}=l;if(!u[i(t)])throw new A(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let m=f(t,o),g=c(r,t,"update"),x=await u[i(t)].update({where:m,data:g});return y(x,t)},async updateMany(l){let{model:t,where:o,update:r}=l,m=f(t,o),g=c(r,t,"update"),x=await u[i(t)].updateMany({where:m,data:g});return x?x.count:0},async delete(l){let{model:t,where:o}=l,r=f(t,o);try{await u[i(t)].delete({where:r})}catch{}},async deleteMany(l){let{model:t,where:o}=l,r=f(t,o),m=await u[i(t)].deleteMany({where:r});return m?m.count:0},options:n}};0&&(module.exports={prismaAdapter});
