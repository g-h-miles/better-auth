"use strict";var k=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var r=(e,n)=>k(e,"name",{value:n,configurable:!0});var V=(e,n)=>{for(var u in n)k(e,u,{get:n[u],enumerable:!0})},C=(e,n,u,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let f of E(n))!M.call(e,f)&&f!==u&&k(e,f,{get:()=>n[f],enumerable:!(l=P(n,f))||l.enumerable});return e};var _=e=>C(k({},"__esModule",{value:!0}),e);var ue={};V(ue,{prismaAdapter:()=>de});module.exports=_(ue);var i=require("zod"),$=require("better-call");var me=i.z.object({id:i.z.string(),providerId:i.z.string(),accountId:i.z.string(),userId:i.z.string(),accessToken:i.z.string().nullish(),refreshToken:i.z.string().nullish(),idToken:i.z.string().nullish(),accessTokenExpiresAt:i.z.date().nullish(),refreshTokenExpiresAt:i.z.date().nullish(),scope:i.z.string().nullish(),password:i.z.string().nullish(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date)}),ye=i.z.object({id:i.z.string(),email:i.z.string().transform(e=>e.toLowerCase()),emailVerified:i.z.boolean().default(!1),name:i.z.string(),image:i.z.string().nullish(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date)}),ge=i.z.object({id:i.z.string(),userId:i.z.string(),expiresAt:i.z.date(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date),token:i.z.string(),ipAddress:i.z.string().nullish(),userAgent:i.z.string().nullish()}),he=i.z.object({id:i.z.string(),value:i.z.string(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date),expiresAt:i.z.date(),identifier:i.z.string()});var R=Object.create(null),v=r(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?R:globalThis),"_getEnv"),N=new Proxy(R,{get(e,n){return v()[n]??R[n]},has(e,n){let u=v();return n in u||n in R},set(e,n,u){let l=v(!0);return l[n]=u,!0},deleteProperty(e,n){if(!n)return!1;let u=v(!0);return delete u[n],!0},ownKeys(){let e=v(!0);return Object.keys(e)}});function j(e){return e?e!=="false":!1}r(j,"toBoolean");var K=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var H=K==="test"||j(N.TEST);var U=require("@better-auth/utils/random");var T=r(e=>(0,U.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32),"generateId");var Y=require("zod"),ee=require("better-call");var x=class extends Error{static{r(this,"BetterAuthError")}constructor(n,u){super(n),this.name="BetterAuthError",this.message=n,this.cause=u,this.stack=""}};var Z=require("@better-auth/utils/hash"),Q=require("@noble/ciphers/chacha"),I=require("@noble/ciphers/utils"),X=require("@noble/ciphers/webcrypto");var W=require("@noble/hashes/scrypt"),J=require("uncrypto"),G=require("@better-auth/utils/hex");var q=require("@better-auth/utils/random"),z=(0,q.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var F=["info","success","warn","error","debug"];function te(e,n){return F.indexOf(n)<=F.indexOf(e)}r(te,"shouldPublishLog");var A={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},re={info:A.fg.blue,success:A.fg.green,warn:A.fg.yellow,error:A.fg.red,debug:A.fg.magenta},ne=r((e,n)=>{let u=new Date().toISOString();return`${A.dim}${u}${A.reset} ${re[e]}${e.toUpperCase()}${A.reset} ${A.bright}Better Auth${A.reset} ${n}`},"formatMessage"),S=r(e=>{let n=e?.disabled!==!0,u=e?.level??"error",l=r((f,g,p=[])=>{if(!n||!te(u,f))return;let o=ne(f,g);if(!e||typeof e.log!="function"){f==="error"?console.error(o,...p):f==="warn"?console.warn(o,...p):console.log(o,...p);return}e.log(f==="success"?"info":f,o,...p)},"LogFunc");return Object.fromEntries(F.map(f=>[f,(...[g,...p])=>l(f,g,p)]))},"createLogger"),se=S();var b=r(e=>{let n=e.plugins?.reduce((a,m)=>{let c=m.schema;if(!c)return a;for(let[t,d]of Object.entries(c))a[t]={fields:{...a[t]?.fields,...d.fields},modelName:d.modelName||t};return a},{}),u=e.rateLimit?.storage==="database",l={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:f,session:g,account:p,...o}=n||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:r(()=>!1,"defaultValue"),required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:r(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:r(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...f?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...g?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...p?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:r(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:r(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...o,...u?l:{}}},"getAuthTables");var ie=require("zod");var B=require("kysely"),D=require("kysely");function O(e,n,u){return u==="update"?e:e==null&&n.defaultValue?typeof n.defaultValue=="function"?n.defaultValue():n.defaultValue:e}r(O,"withApplyDefault");var oe=r((e,n)=>{let u=b(n);function l(o,a){return a==="id"?a:u[o].fields[a].fieldName||a}r(l,"getField");function f(o){switch(o){case"starts_with":return"startsWith";case"ends_with":return"endsWith";default:return o}}r(f,"operatorToPrismaOperator");function g(o){return u[o].modelName}r(g,"getModelName");let p=n?.advanced?.generateId===!1;return{transformInput(o,a,m){let c=p||m==="update"?{}:{id:n.advanced?.generateId?n.advanced.generateId({model:a}):o.id||T()},t=u[a].fields;for(let d in t){let s=o[d];s===void 0&&(!t[d].defaultValue||m==="update")||(c[t[d].fieldName||d]=O(s,t[d],m))}return c},transformOutput(o,a,m=[]){if(!o)return null;let c=o.id||o._id?m.length===0||m.includes("id")?{id:o.id}:{}:{},t=u[a].fields;for(let d in t){if(m.length&&!m.includes(d))continue;let s=t[d];s&&(c[d]=o[s.fieldName||d])}return c},convertWhereClause(o,a){if(!a)return{};if(a.length===1){let s=a[0];return s?{[l(o,s.field)]:s.operator==="eq"||!s.operator?s.value:{[f(s.operator)]:s.value}}:void 0}let m=a.filter(s=>s.connector==="AND"||!s.connector),c=a.filter(s=>s.connector==="OR"),t=m.map(s=>({[l(o,s.field)]:s.operator==="eq"||!s.operator?s.value:{[f(s.operator)]:s.value}})),d=c.map(s=>({[l(o,s.field)]:{[s.operator||"eq"]:s.value}}));return{...t.length?{AND:t}:{},...d.length?{OR:d}:{}}},convertSelect:r((o,a)=>{if(!(!o||!a))return o.reduce((m,c)=>({...m,[l(a,c)]:!0}),{})},"convertSelect"),getModelName:g,getField:l}},"createTransform"),de=r((e,n)=>u=>{let l=e,{transformInput:f,transformOutput:g,convertWhereClause:p,convertSelect:o,getModelName:a,getField:m}=oe(n,u);return{id:"prisma",async create(c){let{model:t,data:d,select:s}=c,y=f(d,t,"create");if(!l[a(t)])throw new x(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let h=await l[a(t)].create({data:y,select:o(s,t)});return g(h,t,s)},async findOne(c){let{model:t,where:d,select:s}=c,y=p(t,d);if(!l[a(t)])throw new x(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let h=await l[a(t)].findFirst({where:y,select:o(s,t)});return g(h,t,s)},async findMany(c){let{model:t,where:d,limit:s,offset:y,sortBy:h}=c,w=p(t,d);if(!l[a(t)])throw new x(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return(await l[a(t)].findMany({where:w,take:s||100,skip:y||0,...h?.field?{orderBy:{[m(t,h.field)]:h.direction==="desc"?"desc":"asc"}}:{}})).map(L=>g(L,t))},async update(c){let{model:t,where:d,update:s}=c;if(!l[a(t)])throw new x(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let y=p(t,d),h=f(s,t,"update"),w=await l[a(t)].update({where:y,data:h});return g(w,t)},async updateMany(c){let{model:t,where:d,update:s}=c,y=p(t,d),h=f(s,t,"update"),w=await l[a(t)].updateMany({where:y,data:h});return w?w.count:0},async delete(c){let{model:t,where:d}=c,s=p(t,d);try{await l[a(t)].delete({where:s})}catch{}},async deleteMany(c){let{model:t,where:d}=c,s=p(t,d),y=await l[a(t)].deleteMany({where:s});return y?y.count:0},options:n}},"prismaAdapter");0&&(module.exports={prismaAdapter});
