"use strict";var O=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var i=(e,t)=>O(e,"name",{value:t,configurable:!0});var K=(e,t)=>{for(var c in t)O(e,c,{get:t[c],enumerable:!0})},H=(e,t,c,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let y of j(t))!$.call(e,y)&&y!==c&&O(e,y,{get:()=>t[y],enumerable:!(g=C(t,y))||g.enumerable});return e};var W=e=>H(O({},"__esModule",{value:!0}),e);var pe={};K(pe,{createKyselyAdapter:()=>U,kyselyAdapter:()=>_});module.exports=W(pe);var k=require("kysely"),v=require("kysely");function B(e){if(!e)return null;if("dialect"in e)return B(e.dialect);if("createDriver"in e){if(e instanceof v.SqliteDialect)return"sqlite";if(e instanceof v.MysqlDialect)return"mysql";if(e instanceof v.PostgresDialect)return"postgres";if(e instanceof k.MssqlDialect)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":null}i(B,"getDatabaseType");var U=i(async e=>{let t=e.database;if(!t)return{kysely:null,databaseType:null};if("db"in t)return{kysely:t.db,databaseType:t.type};if("dialect"in t)return{kysely:new k.Kysely({dialect:t.dialect}),databaseType:t.type};let c,g=B(t);return"createDriver"in t&&(c=t),"aggregate"in t&&(c=new v.SqliteDialect({database:t})),"getConnection"in t&&(c=new v.MysqlDialect(t)),"connect"in t&&(c=new v.PostgresDialect({pool:t})),{kysely:c?new k.Kysely({dialect:c}):null,databaseType:g}},"createKyselyAdapter");var u=require("zod"),J=require("better-call");var xe=u.z.object({id:u.z.string(),providerId:u.z.string(),accountId:u.z.string(),userId:u.z.string(),accessToken:u.z.string().nullish(),refreshToken:u.z.string().nullish(),idToken:u.z.string().nullish(),accessTokenExpiresAt:u.z.date().nullish(),refreshTokenExpiresAt:u.z.date().nullish(),scope:u.z.string().nullish(),password:u.z.string().nullish(),createdAt:u.z.date().default(()=>new Date),updatedAt:u.z.date().default(()=>new Date)}),we=u.z.object({id:u.z.string(),email:u.z.string().transform(e=>e.toLowerCase()),emailVerified:u.z.boolean().default(!1),name:u.z.string(),image:u.z.string().nullish(),createdAt:u.z.date().default(()=>new Date),updatedAt:u.z.date().default(()=>new Date)}),be=u.z.object({id:u.z.string(),userId:u.z.string(),expiresAt:u.z.date(),createdAt:u.z.date().default(()=>new Date),updatedAt:u.z.date().default(()=>new Date),token:u.z.string(),ipAddress:u.z.string().nullish(),userAgent:u.z.string().nullish()}),ve=u.z.object({id:u.z.string(),value:u.z.string(),createdAt:u.z.date().default(()=>new Date),updatedAt:u.z.date().default(()=>new Date),expiresAt:u.z.date(),identifier:u.z.string()});var D=Object.create(null),R=i(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?D:globalThis),"_getEnv"),E=new Proxy(D,{get(e,t){return R()[t]??D[t]},has(e,t){let c=R();return t in c||t in D},set(e,t,c){let g=R(!0);return g[t]=c,!0},deleteProperty(e,t){if(!t)return!1;let c=R(!0);return delete c[t],!0},ownKeys(){let e=R(!0);return Object.keys(e)}});function z(e){return e?e!=="false":!1}i(z,"toBoolean");var G=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Z=G==="test"||z(E.TEST);var V=require("@better-auth/utils/random");var I=i(e=>(0,V.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32),"generateId");var se=require("zod"),ae=require("better-call");var re=require("@better-auth/utils/hash"),ne=require("@noble/ciphers/chacha"),S=require("@noble/ciphers/utils"),ie=require("@noble/ciphers/webcrypto");var X=require("@noble/hashes/scrypt"),Y=require("uncrypto"),ee=require("@better-auth/utils/hex");var P=require("@better-auth/utils/random"),te=(0,P.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var q=["info","success","warn","error","debug"];function oe(e,t){return q.indexOf(t)<=q.indexOf(e)}i(oe,"shouldPublishLog");var b={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},de={info:b.fg.blue,success:b.fg.green,warn:b.fg.yellow,error:b.fg.red,debug:b.fg.magenta},ue=i((e,t)=>{let c=new Date().toISOString();return`${b.dim}${c}${b.reset} ${de[e]}${e.toUpperCase()}${b.reset} ${b.bright}Better Auth${b.reset} ${t}`},"formatMessage"),M=i(e=>{let t=e?.disabled!==!0,c=e?.level??"error",g=i((y,w,h=[])=>{if(!t||!oe(c,y))return;let x=ue(y,w);if(!e||typeof e.log!="function"){y==="error"?console.error(x,...h):y==="warn"?console.warn(x,...h):console.log(x,...h);return}e.log(y==="success"?"info":y,x,...h)},"LogFunc");return Object.fromEntries(q.map(y=>[y,(...[w,...h])=>g(y,w,h)]))},"createLogger"),le=M();var F=i(e=>{let t=e.plugins?.reduce((T,s)=>{let r=s.schema;if(!r)return T;for(let[o,l]of Object.entries(r))T[o]={fields:{...T[o]?.fields,...l.fields},modelName:l.modelName||o};return T},{}),c=e.rateLimit?.storage==="database",g={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:y,session:w,account:h,...x}=t||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:i(()=>!1,"defaultValue"),required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:i(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:i(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...y?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...w?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...h?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:i(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:i(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...x,...c?g:{}}},"getAuthTables");var ce=require("zod");function L(e,t,c){return c==="update"?e:e==null&&t.defaultValue?typeof t.defaultValue=="function"?t.defaultValue():t.defaultValue:e}i(L,"withApplyDefault");var fe=i((e,t,c)=>{let g=F(t);function y(s,r){if(r==="id")return r;let o=g[s].fields[r];return o||console.log("Field not found",s,r),o.fieldName||r}i(y,"getField");function w(s,r,o){let{type:l="sqlite"}=c||{},d=g[r].fields[o];return d.type==="boolean"&&l==="sqlite"&&s!==null&&s!==void 0?s?1:0:d.type==="date"&&s&&s instanceof Date&&l==="sqlite"?s.toISOString():s}i(w,"transformValueToDB");function h(s,r,o){let{type:l="sqlite"}=c||{},d=g[r].fields[o];return d.type==="boolean"&&l==="sqlite"&&s!==null?s===1:d.type==="date"&&s?new Date(s):s}i(h,"transformValueFromDB");function x(s){return g[s].modelName}i(x,"getModelName");let T=t?.advanced?.generateId===!1;return{transformInput(s,r,o){let l=T||o==="update"?{}:{id:t.advanced?.generateId?t.advanced.generateId({model:r}):s.id||I()},d=g[r].fields;for(let n in d){let a=s[n];l[d[n].fieldName||n]=L(w(a,r,n),d[n],o)}return l},transformOutput(s,r,o=[]){if(!s)return null;let l=s.id?o.length===0||o.includes("id")?{id:s.id}:{}:{},d=g[r].fields;for(let n in d){if(o.length&&!o.includes(n))continue;let a=d[n];a&&(l[n]=h(s[a.fieldName||n],r,n))}return l},convertWhereClause(s,r){if(!r)return{and:null,or:null};let o={and:[],or:[]};return r.forEach(l=>{let{field:d,value:n,operator:a="=",connector:p="AND"}=l,f=y(s,d),A=i(m=>a.toLowerCase()==="in"?m(f,"in",Array.isArray(n)?n:[n]):a==="contains"?m(f,"like",`%${n}%`):a==="starts_with"?m(f,"like",`${n}%`):a==="ends_with"?m(f,"like",`%${n}`):a==="eq"?m(f,"=",n):a==="ne"?m(f,"<>",n):a==="gt"?m(f,">",n):a==="gte"?m(f,">=",n):a==="lt"?m(f,"<",n):a==="lte"?m(f,"<=",n):m(f,a,n),"expr");p==="OR"?o.or.push(A):o.and.push(A)}),{and:o.and.length?o.and:null,or:o.or.length?o.or:null}},async withReturning(s,r,o,l){let d;if(c?.type!=="mysql")d=await r.returningAll().executeTakeFirst();else{await r.execute();let n=s.id?"id":l[0].field?l[0].field:"id",a=s[n]||l[0].value;d=await e.selectFrom(x(o)).selectAll().where(y(o,n),"=",a).executeTakeFirst()}return d},getModelName:x,getField:y}},"createTransform"),_=i((e,t)=>c=>{let{transformInput:g,withReturning:y,transformOutput:w,convertWhereClause:h,getModelName:x,getField:T}=fe(e,c,t);return{id:"kysely",async create(s){let{model:r,data:o,select:l}=s,d=g(o,r,"create"),n=e.insertInto(x(r)).values(d);return w(await y(d,n,r,[]),r,l)},async findOne(s){let{model:r,where:o,select:l}=s,{and:d,or:n}=h(r,o),a=e.selectFrom(x(r)).selectAll();d&&(a=a.where(f=>f.and(d.map(A=>A(f))))),n&&(a=a.where(f=>f.or(n.map(A=>A(f)))));let p=await a.executeTakeFirst();return p?w(p,r,l):null},async findMany(s){let{model:r,where:o,limit:l,offset:d,sortBy:n}=s,{and:a,or:p}=h(r,o),f=e.selectFrom(x(r));a&&(f=f.where(m=>m.and(a.map(N=>N(m))))),p&&(f=f.where(m=>m.or(p.map(N=>N(m))))),f=f.limit(l||100),d&&(f=f.offset(d)),n&&(f=f.orderBy(T(r,n.field),n.direction));let A=await f.selectAll().execute();return A?A.map(m=>w(m,r)):[]},async update(s){let{model:r,where:o,update:l}=s,{and:d,or:n}=h(r,o),a=g(l,r,"update"),p=e.updateTable(x(r)).set(a);return d&&(p=p.where(A=>A.and(d.map(m=>m(A))))),n&&(p=p.where(A=>A.or(n.map(m=>m(A))))),await w(await y(a,p,r,o),r)},async updateMany(s){let{model:r,where:o,update:l}=s,{and:d,or:n}=h(r,o),a=g(l,r,"update"),p=e.updateTable(x(r)).set(a);return d&&(p=p.where(A=>A.and(d.map(m=>m(A))))),n&&(p=p.where(A=>A.or(n.map(m=>m(A))))),(await p.execute()).length},async delete(s){let{model:r,where:o}=s,{and:l,or:d}=h(r,o),n=e.deleteFrom(x(r));l&&(n=n.where(a=>a.and(l.map(p=>p(a))))),d&&(n=n.where(a=>a.or(d.map(p=>p(a))))),await n.execute()},async deleteMany(s){let{model:r,where:o}=s,{and:l,or:d}=h(r,o),n=e.deleteFrom(x(r));return l&&(n=n.where(a=>a.and(l.map(p=>p(a))))),d&&(n=n.where(a=>a.or(d.map(p=>p(a))))),(await n.execute()).length},options:t}},"kyselyAdapter");0&&(module.exports={createKyselyAdapter,kyselyAdapter});
