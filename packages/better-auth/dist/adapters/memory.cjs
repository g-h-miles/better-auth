"use strict";var x=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var t=(e,n)=>x(e,"name",{value:n,configurable:!0});var E=(e,n)=>{for(var c in n)x(e,c,{get:n[c],enumerable:!0})},V=(e,n,c,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of L(n))!B.call(e,s)&&s!==c&&x(e,s,{get:()=>n[s],enumerable:!(l=q(n,s))||l.enumerable});return e};var P=e=>V(x({},"__esModule",{value:!0}),e);var ae={};E(ae,{memoryAdapter:()=>S});module.exports=P(ae);var i=require("zod"),M=require("better-call");var le=i.z.object({id:i.z.string(),providerId:i.z.string(),accountId:i.z.string(),userId:i.z.string(),accessToken:i.z.string().nullish(),refreshToken:i.z.string().nullish(),idToken:i.z.string().nullish(),accessTokenExpiresAt:i.z.date().nullish(),refreshTokenExpiresAt:i.z.date().nullish(),scope:i.z.string().nullish(),password:i.z.string().nullish(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date)}),ce=i.z.object({id:i.z.string(),email:i.z.string().transform(e=>e.toLowerCase()),emailVerified:i.z.boolean().default(!1),name:i.z.string(),image:i.z.string().nullish(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date)}),fe=i.z.object({id:i.z.string(),userId:i.z.string(),expiresAt:i.z.date(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date),token:i.z.string(),ipAddress:i.z.string().nullish(),userAgent:i.z.string().nullish()}),pe=i.z.object({id:i.z.string(),value:i.z.string(),createdAt:i.z.date().default(()=>new Date),updatedAt:i.z.date().default(()=>new Date),expiresAt:i.z.date(),identifier:i.z.string()});var w=Object.create(null),g=t(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?w:globalThis),"_getEnv"),O=new Proxy(w,{get(e,n){return g()[n]??w[n]},has(e,n){let c=g();return n in c||n in w},set(e,n,c){let l=g(!0);return l[n]=c,!0},deleteProperty(e,n){if(!n)return!1;let c=g(!0);return delete c[n],!0},ownKeys(){let e=g(!0);return Object.keys(e)}});function _(e){return e?e!=="false":!1}t(_,"toBoolean");var C=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var j=C==="test"||_(O.TEST);var D=require("@better-auth/utils/random");var b=t(e=>(0,D.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32),"generateId");var Q=require("zod"),X=require("better-call");var z=require("@better-auth/utils/hash"),G=require("@noble/ciphers/chacha"),v=require("@noble/ciphers/utils"),Z=require("@noble/ciphers/webcrypto");var K=require("@noble/hashes/scrypt"),H=require("uncrypto"),W=require("@better-auth/utils/hex");var I=require("@better-auth/utils/random"),J=(0,I.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var T=["info","success","warn","error","debug"];function Y(e,n){return T.indexOf(n)<=T.indexOf(e)}t(Y,"shouldPublishLog");var m={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},ee={info:m.fg.blue,success:m.fg.green,warn:m.fg.yellow,error:m.fg.red,debug:m.fg.magenta},te=t((e,n)=>{let c=new Date().toISOString();return`${m.dim}${c}${m.reset} ${ee[e]}${e.toUpperCase()}${m.reset} ${m.bright}Better Auth${m.reset} ${n}`},"formatMessage"),N=t(e=>{let n=e?.disabled!==!0,c=e?.level??"error",l=t((s,p,r=[])=>{if(!n||!Y(c,s))return;let o=te(s,p);if(!e||typeof e.log!="function"){s==="error"?console.error(o,...r):s==="warn"?console.warn(o,...r):console.log(o,...r);return}e.log(s==="success"?"info":s,o,...r)},"LogFunc");return Object.fromEntries(T.map(s=>[s,(...[p,...r])=>l(s,p,r)]))},"createLogger"),re=N();var A=t(e=>{let n=e.plugins?.reduce((a,u)=>{let f=u.schema;if(!f)return a;for(let[d,y]of Object.entries(f))a[d]={fields:{...a[d]?.fields,...y.fields},modelName:y.modelName||d};return a},{}),c=e.rateLimit?.storage==="database",l={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:s,session:p,account:r,...o}=n||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:t(()=>!1,"defaultValue"),required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:t(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:t(()=>new Date,"defaultValue"),required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...s?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...p?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...r?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:t(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:t(()=>new Date,"defaultValue"),fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...o,...c?l:{}}},"getAuthTables");var ne=require("zod");var U=require("kysely"),k=require("kysely");function R(e,n,c){return c==="update"?e:e==null&&n.defaultValue?typeof n.defaultValue=="function"?n.defaultValue():n.defaultValue:e}t(R,"withApplyDefault");var se=t(e=>{let n=A(e);function c(l,s){return s==="id"?s:n[l].fields[s].fieldName||s}return t(c,"getField"),{transformInput(l,s,p){let r=p==="update"?{}:{id:e.advanced?.generateId?e.advanced.generateId({model:s}):l.id||b()},o=n[s].fields;for(let a in o){let u=l[a];u===void 0&&!o[a].defaultValue||(r[o[a].fieldName||a]=R(u,o[a],p))}return r},transformOutput(l,s,p=[]){if(!l)return null;let r=l.id||l._id?p.length===0||p.includes("id")?{id:l.id}:{}:{},o=n[s].fields;for(let a in o){if(p.length&&!p.includes(a))continue;let u=o[a];u&&(r[a]=l[u.fieldName||a])}return r},convertWhereClause(l,s,p){return s.filter(r=>l.every(o=>{let{field:a,value:u,operator:f}=o,d=c(p,a);if(f==="in"){if(!Array.isArray(u))throw new Error("Value must be an array");return u.includes(r[d])}else return f==="contains"?r[d].includes(u):f==="starts_with"?r[d].startsWith(u):f==="ends_with"?r[d].endsWith(u):r[d]===u}))},getField:c}},"createTransform"),S=t(e=>n=>{let{transformInput:c,transformOutput:l,convertWhereClause:s,getField:p}=se(n);return{id:"memory",create:t(async({model:r,data:o})=>{let a=c(o,r,"create");return e[r].push(a),l(a,r)},"create"),findOne:t(async({model:r,where:o,select:a})=>{let u=e[r],d=s(o,u,r)[0]||null;return l(d,r,a)},"findOne"),findMany:t(async({model:r,where:o,sortBy:a,limit:u,offset:f})=>{let d=e[r];return o&&(d=s(o,d,r)),a&&(d=d.sort((y,F)=>{let h=p(r,a.field);return a.direction==="asc"?y[h]>F[h]?1:-1:y[h]<F[h]?1:-1})),f!==void 0&&(d=d.slice(f)),u!==void 0&&(d=d.slice(0,u)),d.map(y=>l(y,r))},"findMany"),update:t(async({model:r,where:o,update:a})=>{let u=e[r],f=s(o,u,r);return f.forEach(d=>{Object.assign(d,c(a,r,"update"))}),l(f[0],r)},"update"),delete:t(async({model:r,where:o})=>{let a=e[r],u=s(o,a,r);e[r]=a.filter(f=>!u.includes(f))},"delete"),deleteMany:t(async({model:r,where:o})=>{let a=e[r],u=s(o,a,r),f=0;return e[r]=a.filter(d=>u.includes(d)?(f++,!1):!u.includes(d)),f},"deleteMany"),updateMany(r){let{model:o,where:a,update:u}=r,f=e[o],d=s(a,f,o);return d.forEach(y=>{Object.assign(y,u)}),d[0]||null}}},"memoryAdapter");0&&(module.exports={memoryAdapter});
