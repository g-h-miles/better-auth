var w=Object.defineProperty;var n=(e,o)=>w(e,"name",{value:o,configurable:!0});var d=class extends Error{static{n(this,"BetterAuthError")}constructor(o,i){super(o),this.name="BetterAuthError",this.message=o,this.cause=i,this.stack=""}};var C=n((e,o="ms")=>new Date(Date.now()+(o==="sec"?e*1e3:e)),"getDate");var f=Object.create(null),l=n(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?f:globalThis),"_getEnv"),D=new Proxy(f,{get(e,o){return l()[o]??f[o]},has(e,o){let i=l();return o in i||o in f},set(e,o,i){let s=l(!0);return s[o]=i,!0},deleteProperty(e,o){if(!o)return!1;let i=l(!0);return delete i[o],!0},ownKeys(){let e=l(!0);return Object.keys(e)}});function O(e){return e?e!=="false":!1}n(O,"toBoolean");var y=typeof process<"u"&&process.env&&process.env.NODE_ENV||"",M=y==="production";var Y=y==="test"||O(D.TEST);import{base64Url as v}from"@better-auth/utils/base64";var m=n((e,o)=>{let i=n(()=>{switch(o){case"ms":return e;case"s":return e*1e3;case"m":return e*1e3*60;case"h":return e*1e3*60*60;case"d":return e*1e3*60*60*24;case"w":return e*1e3*60*60*24*7;case"y":return e*1e3*60*60*24*365}},"toMilliseconds"),s={t:`${e}${o}`,value:e,tFormat:o,toMilliseconds:i,toSeconds:n(()=>s.toMilliseconds()/1e3,"toSeconds"),toMinutes:n(()=>s.toSeconds()/60,"toMinutes"),toHours:n(()=>s.toMinutes()/60,"toHours"),toDays:n(()=>s.toHours()/24,"toDays"),toWeeks:n(()=>s.toDays()/7,"toWeeks"),toYears:n(()=>s.toDays()/365,"toYears"),getDate:n(()=>new Date(Date.now()+s.toMilliseconds()),"getDate"),add:n(t=>{let r=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return m(s.toMilliseconds()+r,"ms")},"add"),subtract:n(t=>{let r=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return m(s.toMilliseconds()-r,"ms")},"subtract"),multiply:n(t=>m(s.toMilliseconds()*t,"ms"),"multiply"),divide:n(t=>m(s.toMilliseconds()/t,"ms"),"divide"),equals:n(t=>{let r=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()===r},"equals"),lessThan:n(t=>{let r=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()<r},"lessThan"),greaterThan:n(t=>{let r=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()>r},"greaterThan"),format:n(t=>{let r=s.getDate();return t.replace(/YYYY|MM|DD|HH|mm|ss/g,u=>{switch(u){case"YYYY":return r.getFullYear().toString();case"MM":return(r.getMonth()+1).toString().padStart(2,"0");case"DD":return r.getDate().toString().padStart(2,"0");case"HH":return r.getHours().toString().padStart(2,"0");case"mm":return r.getMinutes().toString().padStart(2,"0");case"ss":return r.getSeconds().toString().padStart(2,"0");default:return u}})},"format"),fromNow:n(()=>{let t=s.toMilliseconds();return t<0?s.ago():t<1e3?"in a few seconds":t<6e4?`in ${Math.round(t/1e3)} seconds`:t<36e5?`in ${Math.round(t/6e4)} minutes`:t<864e5?`in ${Math.round(t/36e5)} hours`:t<6048e5?`in ${Math.round(t/864e5)} days`:t<26298e5?`in ${Math.round(t/6048e5)} weeks`:t<315576e5?`in ${Math.round(t/26298e5)} months`:`in ${Math.round(t/315576e5)} years`},"fromNow"),ago:n(()=>{let t=-s.toMilliseconds();return t<0?s.fromNow():t<1e3?"a few seconds ago":t<6e4?`${Math.round(t/1e3)} seconds ago`:t<36e5?`${Math.round(t/6e4)} minutes ago`:t<864e5?`${Math.round(t/36e5)} hours ago`:t<6048e5?`${Math.round(t/864e5)} days ago`:t<26298e5?`${Math.round(t/6048e5)} weeks ago`:t<315576e5?`${Math.round(t/26298e5)} months ago`:`${Math.round(t/315576e5)} years ago`},"ago")};return s},"createTime"),p=n(e=>{let o=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!o)throw new Error("Invalid time format");return m(parseInt(o[1]),o[2])},"parseTime");import{createHMAC as A}from"@better-auth/utils/hmac";function B(e){let o=new Map;return e.split(", ").forEach(s=>{let t=s.split(";").map(h=>h.trim()),[r,...u]=t,[b,...k]=r.split("="),g=k.join("=");if(!b||g===void 0)return;let c={value:g};u.forEach(h=>{let[x,...S]=h.split("="),a=S.join("="),T=x.trim().toLowerCase();switch(T){case"max-age":c["max-age"]=a?parseInt(a.trim(),10):void 0;break;case"expires":c.expires=a?new Date(a.trim()):void 0;break;case"domain":c.domain=a?a.trim():void 0;break;case"path":c.path=a?a.trim():void 0;break;case"secure":c.secure=!0;break;case"httponly":c.httponly=!0;break;case"samesite":c.samesite=a?a.trim().toLowerCase():void 0;break;default:c[T]=a?a.trim():!0;break}}),o.set(b,c)}),o}n(B,"parseSetCookieHeader");function j(e){let i=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?!!e.baseURL.startsWith("https://"):M)?"__Secure-":"",s=!!e.advanced?.crossSubDomainCookies?.enabled,t=s?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(s&&!t)throw new d("baseURL is required when crossSubdomainCookies are enabled");function r(u,b={}){let k=e.advanced?.cookiePrefix||"better-auth",g=e.advanced?.cookies?.[u]?.name||`${k}.${u}`,c=e.advanced?.cookies?.[u]?.attributes;return{name:`${i}${g}`,attributes:{secure:!!i,sameSite:"lax",path:"/",httpOnly:!0,...s?{domain:t}:{},...e.advanced?.defaultCookieAttributes,...b,...c}}}return n(r,"createCookie"),r}n(j,"createCookieGetter");function X(e){let o=j(e),i=e.session?.expiresIn||m(7,"d").toSeconds(),s=o("session_token",{maxAge:i}),t=o("session_data",{maxAge:e.session?.cookieCache?.maxAge||60*5}),r=o("dont_remember");return{sessionToken:{name:s.name,options:s.attributes},sessionData:{name:t.name,options:t.attributes},dontRememberToken:{name:r.name,options:r.attributes}}}n(X,"getCookies");async function $(e,o){if(e.context.options.session?.cookieCache?.enabled){let s=v.encode(JSON.stringify({session:o,expiresAt:C(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await A("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify(o))}),{padding:!1});if(s.length>4093)throw new d("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}n($,"setCookieCache");async function Z(e,o,i,s){let t=e.context.authCookies.sessionToken.options,r=i?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,o.session.token,e.context.secret,{...t,maxAge:r,...s}),i&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await $(e,o),e.context.setNewSession(o),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(o.session.token,JSON.stringify({user:o.user,session:o.session}),Math.floor((new Date(o.session.expiresAt).getTime()-Date.now())/1e3))}n(Z,"setSessionCookie");function ee(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}n(ee,"deleteSessionCookie");function te(e){let o=e.split("; "),i=new Map;return o.forEach(s=>{let[t,r]=s.split("=");i.set(t,r)}),i}n(te,"parseCookies");export{j as createCookieGetter,ee as deleteSessionCookie,X as getCookies,te as parseCookies,B as parseSetCookieHeader,$ as setCookieCache,Z as setSessionCookie};
