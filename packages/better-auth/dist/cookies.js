var m=class extends Error{constructor(o,r){super(o),this.name="BetterAuthError",this.message=o,this.cause=r,this.stack=""}};var T=(e,o="ms")=>new Date(Date.now()+(o==="sec"?e*1e3:e));var g=Object.create(null),d=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?g:globalThis),S=new Proxy(g,{get(e,o){return d()[o]??g[o]},has(e,o){let r=d();return o in r||o in g},set(e,o,r){let s=d(!0);return s[o]=r,!0},deleteProperty(e,o){if(!o)return!1;let r=d(!0);return delete r[o],!0},ownKeys(){let e=d(!0);return Object.keys(e)}});function w(e){return e?e!=="false":!1}var C=typeof process<"u"&&process.env&&process.env.NODE_ENV||"",y=C==="production";var E=C==="test"||w(S.TEST);import{base64Url as D}from"@better-auth/utils/base64";var u=(e,o)=>{let r=()=>{switch(o){case"ms":return e;case"s":return e*1e3;case"m":return e*1e3*60;case"h":return e*1e3*60*60;case"d":return e*1e3*60*60*24;case"w":return e*1e3*60*60*24*7;case"y":return e*1e3*60*60*24*365}},s={t:`${e}${o}`,value:e,tFormat:o,toMilliseconds:r,toSeconds:()=>s.toMilliseconds()/1e3,toMinutes:()=>s.toSeconds()/60,toHours:()=>s.toMinutes()/60,toDays:()=>s.toHours()/24,toWeeks:()=>s.toDays()/7,toYears:()=>s.toDays()/365,getDate:()=>new Date(Date.now()+s.toMilliseconds()),add:t=>{let n=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return u(s.toMilliseconds()+n,"ms")},subtract:t=>{let n=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return u(s.toMilliseconds()-n,"ms")},multiply:t=>u(s.toMilliseconds()*t,"ms"),divide:t=>u(s.toMilliseconds()/t,"ms"),equals:t=>{let n=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()===n},lessThan:t=>{let n=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()<n},greaterThan:t=>{let n=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()>n},format:t=>{let n=s.getDate();return t.replace(/YYYY|MM|DD|HH|mm|ss/g,c=>{switch(c){case"YYYY":return n.getFullYear().toString();case"MM":return(n.getMonth()+1).toString().padStart(2,"0");case"DD":return n.getDate().toString().padStart(2,"0");case"HH":return n.getHours().toString().padStart(2,"0");case"mm":return n.getMinutes().toString().padStart(2,"0");case"ss":return n.getSeconds().toString().padStart(2,"0");default:return c}})},fromNow:()=>{let t=s.toMilliseconds();return t<0?s.ago():t<1e3?"in a few seconds":t<6e4?`in ${Math.round(t/1e3)} seconds`:t<36e5?`in ${Math.round(t/6e4)} minutes`:t<864e5?`in ${Math.round(t/36e5)} hours`:t<6048e5?`in ${Math.round(t/864e5)} days`:t<26298e5?`in ${Math.round(t/6048e5)} weeks`:t<315576e5?`in ${Math.round(t/26298e5)} months`:`in ${Math.round(t/315576e5)} years`},ago:()=>{let t=-s.toMilliseconds();return t<0?s.fromNow():t<1e3?"a few seconds ago":t<6e4?`${Math.round(t/1e3)} seconds ago`:t<36e5?`${Math.round(t/6e4)} minutes ago`:t<864e5?`${Math.round(t/36e5)} hours ago`:t<6048e5?`${Math.round(t/864e5)} days ago`:t<26298e5?`${Math.round(t/6048e5)} weeks ago`:t<315576e5?`${Math.round(t/26298e5)} months ago`:`${Math.round(t/315576e5)} years ago`}};return s},l=e=>{let o=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!o)throw new Error("Invalid time format");return u(parseInt(o[1]),o[2])};import{createHMAC as O}from"@better-auth/utils/hmac";function H(e){let o=new Map;return e.split(", ").forEach(s=>{let t=s.split(";").map(k=>k.trim()),[n,...c]=t,[p,...f]=n.split("="),b=f.join("=");if(!p||b===void 0)return;let a={value:b};c.forEach(k=>{let[M,...x]=k.split("="),i=x.join("="),h=M.trim().toLowerCase();switch(h){case"max-age":a["max-age"]=i?parseInt(i.trim(),10):void 0;break;case"expires":a.expires=i?new Date(i.trim()):void 0;break;case"domain":a.domain=i?i.trim():void 0;break;case"path":a.path=i?i.trim():void 0;break;case"secure":a.secure=!0;break;case"httponly":a.httponly=!0;break;case"samesite":a.samesite=i?i.trim().toLowerCase():void 0;break;default:a[h]=i?i.trim():!0;break}}),o.set(p,a)}),o}function v(e){let r=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?!!e.baseURL.startsWith("https://"):y)?"__Secure-":"",s=!!e.advanced?.crossSubDomainCookies?.enabled,t=s?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(s&&!t)throw new m("baseURL is required when crossSubdomainCookies are enabled");function n(c,p={}){let f=e.advanced?.cookiePrefix||"better-auth",b=e.advanced?.cookies?.[c]?.name||`${f}.${c}`,a=e.advanced?.cookies?.[c]?.attributes;return{name:`${r}${b}`,attributes:{secure:!!r,sameSite:"lax",path:"/",httpOnly:!0,...s?{domain:t}:{},...e.advanced?.defaultCookieAttributes,...p,...a}}}return n}function G(e){let o=v(e),r=e.session?.expiresIn||u(7,"d").toSeconds(),s=o("session_token",{maxAge:r}),t=o("session_data",{maxAge:e.session?.cookieCache?.maxAge||60*5}),n=o("dont_remember");return{sessionToken:{name:s.name,options:s.attributes},sessionData:{name:t.name,options:t.attributes},dontRememberToken:{name:n.name,options:n.attributes}}}async function A(e,o){if(e.context.options.session?.cookieCache?.enabled){let s=D.encode(JSON.stringify({session:o,expiresAt:T(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await O("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify(o))}),{padding:!1});if(s.length>4093)throw new m("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}async function V(e,o,r,s){let t=e.context.authCookies.sessionToken.options,n=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,o.session.token,e.context.secret,{...t,maxAge:n,...s}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await A(e,o),e.context.setNewSession(o),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(o.session.token,JSON.stringify({user:o.user,session:o.session}),Math.floor((new Date(o.session.expiresAt).getTime()-Date.now())/1e3))}function q(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}function J(e){let o=e.split("; "),r=new Map;return o.forEach(s=>{let[t,n]=s.split("=");r.set(t,n)}),r}export{v as createCookieGetter,q as deleteSessionCookie,G as getCookies,J as parseCookies,H as parseSetCookieHeader,A as setCookieCache,V as setSessionCookie};
