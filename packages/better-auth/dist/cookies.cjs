"use strict";var f=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var n=(e,o)=>f(e,"name",{value:o,configurable:!0});var _=(e,o)=>{for(var r in o)f(e,r,{get:o[r],enumerable:!0})},R=(e,o,r,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of $(o))!E.call(e,t)&&t!==r&&f(e,t,{get:()=>o[t],enumerable:!(s=j(o,t))||s.enumerable});return e};var H=e=>R(f({},"__esModule",{value:!0}),e);var I={};_(I,{createCookieGetter:()=>D,deleteSessionCookie:()=>L,getCookies:()=>N,parseCookies:()=>B,parseSetCookieHeader:()=>U,setCookieCache:()=>O,setSessionCookie:()=>F});module.exports=H(I);var d=class extends Error{static{n(this,"BetterAuthError")}constructor(o,r){super(o),this.name="BetterAuthError",this.message=o,this.cause=r,this.stack=""}};var y=n((e,o="ms")=>new Date(Date.now()+(o==="sec"?e*1e3:e)),"getDate");var k=Object.create(null),l=n(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?k:globalThis),"_getEnv"),P=new Proxy(k,{get(e,o){return l()[o]??k[o]},has(e,o){let r=l();return o in r||o in k},set(e,o,r){let s=l(!0);return s[o]=r,!0},deleteProperty(e,o){if(!o)return!1;let r=l(!0);return delete r[o],!0},ownKeys(){let e=l(!0);return Object.keys(e)}});function Y(e){return e?e!=="false":!1}n(Y,"toBoolean");var M=typeof process<"u"&&process.env&&process.env.NODE_ENV||"",x=M==="production";var z=M==="test"||Y(P.TEST);var S=require("@better-auth/utils/base64");var m=n((e,o)=>{let r=n(()=>{switch(o){case"ms":return e;case"s":return e*1e3;case"m":return e*1e3*60;case"h":return e*1e3*60*60;case"d":return e*1e3*60*60*24;case"w":return e*1e3*60*60*24*7;case"y":return e*1e3*60*60*24*365}},"toMilliseconds"),s={t:`${e}${o}`,value:e,tFormat:o,toMilliseconds:r,toSeconds:n(()=>s.toMilliseconds()/1e3,"toSeconds"),toMinutes:n(()=>s.toSeconds()/60,"toMinutes"),toHours:n(()=>s.toMinutes()/60,"toHours"),toDays:n(()=>s.toHours()/24,"toDays"),toWeeks:n(()=>s.toDays()/7,"toWeeks"),toYears:n(()=>s.toDays()/365,"toYears"),getDate:n(()=>new Date(Date.now()+s.toMilliseconds()),"getDate"),add:n(t=>{let i=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return m(s.toMilliseconds()+i,"ms")},"add"),subtract:n(t=>{let i=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return m(s.toMilliseconds()-i,"ms")},"subtract"),multiply:n(t=>m(s.toMilliseconds()*t,"ms"),"multiply"),divide:n(t=>m(s.toMilliseconds()/t,"ms"),"divide"),equals:n(t=>{let i=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()===i},"equals"),lessThan:n(t=>{let i=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()<i},"lessThan"),greaterThan:n(t=>{let i=typeof t=="string"?p(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()>i},"greaterThan"),format:n(t=>{let i=s.getDate();return t.replace(/YYYY|MM|DD|HH|mm|ss/g,u=>{switch(u){case"YYYY":return i.getFullYear().toString();case"MM":return(i.getMonth()+1).toString().padStart(2,"0");case"DD":return i.getDate().toString().padStart(2,"0");case"HH":return i.getHours().toString().padStart(2,"0");case"mm":return i.getMinutes().toString().padStart(2,"0");case"ss":return i.getSeconds().toString().padStart(2,"0");default:return u}})},"format"),fromNow:n(()=>{let t=s.toMilliseconds();return t<0?s.ago():t<1e3?"in a few seconds":t<6e4?`in ${Math.round(t/1e3)} seconds`:t<36e5?`in ${Math.round(t/6e4)} minutes`:t<864e5?`in ${Math.round(t/36e5)} hours`:t<6048e5?`in ${Math.round(t/864e5)} days`:t<26298e5?`in ${Math.round(t/6048e5)} weeks`:t<315576e5?`in ${Math.round(t/26298e5)} months`:`in ${Math.round(t/315576e5)} years`},"fromNow"),ago:n(()=>{let t=-s.toMilliseconds();return t<0?s.fromNow():t<1e3?"a few seconds ago":t<6e4?`${Math.round(t/1e3)} seconds ago`:t<36e5?`${Math.round(t/6e4)} minutes ago`:t<864e5?`${Math.round(t/36e5)} hours ago`:t<6048e5?`${Math.round(t/864e5)} days ago`:t<26298e5?`${Math.round(t/6048e5)} weeks ago`:t<315576e5?`${Math.round(t/26298e5)} months ago`:`${Math.round(t/315576e5)} years ago`},"ago")};return s},"createTime"),p=n(e=>{let o=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!o)throw new Error("Invalid time format");return m(parseInt(o[1]),o[2])},"parseTime");var w=require("@better-auth/utils/hmac");function U(e){let o=new Map;return e.split(", ").forEach(s=>{let t=s.split(";").map(T=>T.trim()),[i,...u]=t,[b,...h]=i.split("="),g=h.join("=");if(!b||g===void 0)return;let c={value:g};u.forEach(T=>{let[v,...A]=T.split("="),a=A.join("="),C=v.trim().toLowerCase();switch(C){case"max-age":c["max-age"]=a?parseInt(a.trim(),10):void 0;break;case"expires":c.expires=a?new Date(a.trim()):void 0;break;case"domain":c.domain=a?a.trim():void 0;break;case"path":c.path=a?a.trim():void 0;break;case"secure":c.secure=!0;break;case"httponly":c.httponly=!0;break;case"samesite":c.samesite=a?a.trim().toLowerCase():void 0;break;default:c[C]=a?a.trim():!0;break}}),o.set(b,c)}),o}n(U,"parseSetCookieHeader");function D(e){let r=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?!!e.baseURL.startsWith("https://"):x)?"__Secure-":"",s=!!e.advanced?.crossSubDomainCookies?.enabled,t=s?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(s&&!t)throw new d("baseURL is required when crossSubdomainCookies are enabled");function i(u,b={}){let h=e.advanced?.cookiePrefix||"better-auth",g=e.advanced?.cookies?.[u]?.name||`${h}.${u}`,c=e.advanced?.cookies?.[u]?.attributes;return{name:`${r}${g}`,attributes:{secure:!!r,sameSite:"lax",path:"/",httpOnly:!0,...s?{domain:t}:{},...e.advanced?.defaultCookieAttributes,...b,...c}}}return n(i,"createCookie"),i}n(D,"createCookieGetter");function N(e){let o=D(e),r=e.session?.expiresIn||m(7,"d").toSeconds(),s=o("session_token",{maxAge:r}),t=o("session_data",{maxAge:e.session?.cookieCache?.maxAge||60*5}),i=o("dont_remember");return{sessionToken:{name:s.name,options:s.attributes},sessionData:{name:t.name,options:t.attributes},dontRememberToken:{name:i.name,options:i.attributes}}}n(N,"getCookies");async function O(e,o){if(e.context.options.session?.cookieCache?.enabled){let s=S.base64Url.encode(JSON.stringify({session:o,expiresAt:y(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await(0,w.createHMAC)("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify(o))}),{padding:!1});if(s.length>4093)throw new d("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}n(O,"setCookieCache");async function F(e,o,r,s){let t=e.context.authCookies.sessionToken.options,i=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,o.session.token,e.context.secret,{...t,maxAge:i,...s}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await O(e,o),e.context.setNewSession(o),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(o.session.token,JSON.stringify({user:o.user,session:o.session}),Math.floor((new Date(o.session.expiresAt).getTime()-Date.now())/1e3))}n(F,"setSessionCookie");function L(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}n(L,"deleteSessionCookie");function B(e){let o=e.split("; "),r=new Map;return o.forEach(s=>{let[t,i]=s.split("=");r.set(t,i)}),r}n(B,"parseCookies");0&&(module.exports={createCookieGetter,deleteSessionCookie,getCookies,parseCookies,parseSetCookieHeader,setCookieCache,setSessionCookie});
