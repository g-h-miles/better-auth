"use strict";var h=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var E=(e,o)=>{for(var n in o)h(e,n,{get:o[n],enumerable:!0})},_=(e,o,n,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of j(o))!$.call(e,t)&&t!==n&&h(e,t,{get:()=>o[t],enumerable:!(s=A(o,t))||s.enumerable});return e};var R=e=>_(h({},"__esModule",{value:!0}),e);var B={};E(B,{createCookieGetter:()=>w,deleteSessionCookie:()=>F,getCookies:()=>U,parseCookies:()=>L,parseSetCookieHeader:()=>Y,setCookieCache:()=>D,setSessionCookie:()=>N});module.exports=R(B);var m=class extends Error{constructor(o,n){super(o),this.name="BetterAuthError",this.message=o,this.cause=n,this.stack=""}};var C=(e,o="ms")=>new Date(Date.now()+(o==="sec"?e*1e3:e));var g=Object.create(null),d=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?g:globalThis),H=new Proxy(g,{get(e,o){return d()[o]??g[o]},has(e,o){let n=d();return o in n||o in g},set(e,o,n){let s=d(!0);return s[o]=n,!0},deleteProperty(e,o){if(!o)return!1;let n=d(!0);return delete n[o],!0},ownKeys(){let e=d(!0);return Object.keys(e)}});function P(e){return e?e!=="false":!1}var y=typeof process<"u"&&process.env&&process.env.NODE_ENV||"",M=y==="production";var q=y==="test"||P(H.TEST);var x=require("@better-auth/utils/base64");var u=(e,o)=>{let n=()=>{switch(o){case"ms":return e;case"s":return e*1e3;case"m":return e*1e3*60;case"h":return e*1e3*60*60;case"d":return e*1e3*60*60*24;case"w":return e*1e3*60*60*24*7;case"y":return e*1e3*60*60*24*365}},s={t:`${e}${o}`,value:e,tFormat:o,toMilliseconds:n,toSeconds:()=>s.toMilliseconds()/1e3,toMinutes:()=>s.toSeconds()/60,toHours:()=>s.toMinutes()/60,toDays:()=>s.toHours()/24,toWeeks:()=>s.toDays()/7,toYears:()=>s.toDays()/365,getDate:()=>new Date(Date.now()+s.toMilliseconds()),add:t=>{let r=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return u(s.toMilliseconds()+r,"ms")},subtract:t=>{let r=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return u(s.toMilliseconds()-r,"ms")},multiply:t=>u(s.toMilliseconds()*t,"ms"),divide:t=>u(s.toMilliseconds()/t,"ms"),equals:t=>{let r=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()===r},lessThan:t=>{let r=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()<r},greaterThan:t=>{let r=typeof t=="string"?l(t).toMilliseconds():t.toMilliseconds();return s.toMilliseconds()>r},format:t=>{let r=s.getDate();return t.replace(/YYYY|MM|DD|HH|mm|ss/g,c=>{switch(c){case"YYYY":return r.getFullYear().toString();case"MM":return(r.getMonth()+1).toString().padStart(2,"0");case"DD":return r.getDate().toString().padStart(2,"0");case"HH":return r.getHours().toString().padStart(2,"0");case"mm":return r.getMinutes().toString().padStart(2,"0");case"ss":return r.getSeconds().toString().padStart(2,"0");default:return c}})},fromNow:()=>{let t=s.toMilliseconds();return t<0?s.ago():t<1e3?"in a few seconds":t<6e4?`in ${Math.round(t/1e3)} seconds`:t<36e5?`in ${Math.round(t/6e4)} minutes`:t<864e5?`in ${Math.round(t/36e5)} hours`:t<6048e5?`in ${Math.round(t/864e5)} days`:t<26298e5?`in ${Math.round(t/6048e5)} weeks`:t<315576e5?`in ${Math.round(t/26298e5)} months`:`in ${Math.round(t/315576e5)} years`},ago:()=>{let t=-s.toMilliseconds();return t<0?s.fromNow():t<1e3?"a few seconds ago":t<6e4?`${Math.round(t/1e3)} seconds ago`:t<36e5?`${Math.round(t/6e4)} minutes ago`:t<864e5?`${Math.round(t/36e5)} hours ago`:t<6048e5?`${Math.round(t/864e5)} days ago`:t<26298e5?`${Math.round(t/6048e5)} weeks ago`:t<315576e5?`${Math.round(t/26298e5)} months ago`:`${Math.round(t/315576e5)} years ago`}};return s},l=e=>{let o=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!o)throw new Error("Invalid time format");return u(parseInt(o[1]),o[2])};var S=require("@better-auth/utils/hmac");function Y(e){let o=new Map;return e.split(", ").forEach(s=>{let t=s.split(";").map(k=>k.trim()),[r,...c]=t,[p,...f]=r.split("="),b=f.join("=");if(!p||b===void 0)return;let a={value:b};c.forEach(k=>{let[O,...v]=k.split("="),i=v.join("="),T=O.trim().toLowerCase();switch(T){case"max-age":a["max-age"]=i?parseInt(i.trim(),10):void 0;break;case"expires":a.expires=i?new Date(i.trim()):void 0;break;case"domain":a.domain=i?i.trim():void 0;break;case"path":a.path=i?i.trim():void 0;break;case"secure":a.secure=!0;break;case"httponly":a.httponly=!0;break;case"samesite":a.samesite=i?i.trim().toLowerCase():void 0;break;default:a[T]=i?i.trim():!0;break}}),o.set(p,a)}),o}function w(e){let n=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?!!e.baseURL.startsWith("https://"):M)?"__Secure-":"",s=!!e.advanced?.crossSubDomainCookies?.enabled,t=s?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(s&&!t)throw new m("baseURL is required when crossSubdomainCookies are enabled");function r(c,p={}){let f=e.advanced?.cookiePrefix||"better-auth",b=e.advanced?.cookies?.[c]?.name||`${f}.${c}`,a=e.advanced?.cookies?.[c]?.attributes;return{name:`${n}${b}`,attributes:{secure:!!n,sameSite:"lax",path:"/",httpOnly:!0,...s?{domain:t}:{},...e.advanced?.defaultCookieAttributes,...p,...a}}}return r}function U(e){let o=w(e),n=e.session?.expiresIn||u(7,"d").toSeconds(),s=o("session_token",{maxAge:n}),t=o("session_data",{maxAge:e.session?.cookieCache?.maxAge||60*5}),r=o("dont_remember");return{sessionToken:{name:s.name,options:s.attributes},sessionData:{name:t.name,options:t.attributes},dontRememberToken:{name:r.name,options:r.attributes}}}async function D(e,o){if(e.context.options.session?.cookieCache?.enabled){let s=x.base64Url.encode(JSON.stringify({session:o,expiresAt:C(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await(0,S.createHMAC)("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify(o))}),{padding:!1});if(s.length>4093)throw new m("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}async function N(e,o,n,s){let t=e.context.authCookies.sessionToken.options,r=n?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,o.session.token,e.context.secret,{...t,maxAge:r,...s}),n&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await D(e,o),e.context.setNewSession(o),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(o.session.token,JSON.stringify({user:o.user,session:o.session}),Math.floor((new Date(o.session.expiresAt).getTime()-Date.now())/1e3))}function F(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}function L(e){let o=e.split("; "),n=new Map;return o.forEach(s=>{let[t,r]=s.split("=");n.set(t,r)}),n}0&&(module.exports={createCookieGetter,deleteSessionCookie,getCookies,parseCookies,parseSetCookieHeader,setCookieCache,setSessionCookie});
