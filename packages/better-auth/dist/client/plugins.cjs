"use strict";var y=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var k=(e,t)=>{for(var s in t)y(e,s,{get:t[s],enumerable:!0})},I=(e,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of v(t))!E.call(e,n)&&n!==s&&y(e,n,{get:()=>t[n],enumerable:!(i=B(t,n))||i.enumerable});return e};var _=e=>I(y({},"__esModule",{value:!0}),e);var oe={};k(oe,{InferServerPlugin:()=>O,adminClient:()=>J,anonymousClient:()=>V,customSessionClient:()=>te,emailOTPClient:()=>X,genericOAuthClient:()=>K,getPasskeyActions:()=>w,inferAdditionalFields:()=>H,jwtClient:()=>Q,magicLinkClient:()=>q,multiSessionClient:()=>Y,oidcClient:()=>re,oneTapClient:()=>Z,organizationClient:()=>D,passkeyClient:()=>M,phoneNumberClient:()=>W,ssoClient:()=>ne,twoFactorClient:()=>j,usernameClient:()=>G});module.exports=_(oe);var g=require("nanostores");function A(e){let t=e;return{newRole(s){return U(s)}}}function U(e){return{statements:e,authorize(t,s){for(let[i,n]of Object.entries(t)){let o=e[i];return o?(s==="OR"?n.some(r=>o.includes(r)):n.every(r=>o.includes(r)))?{success:!0}:{success:!1,error:`Unauthorized to access resource "${i}"`}:{success:!1,error:`You are not allowed to access resource: ${i}`}}return{success:!1,error:"Not authorized"}}}}var F={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},h=A(F),S=h.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),T=h.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),R=h.newRole({organization:[],member:[],invitation:[]});var N=require("@better-fetch/fetch");var m=Object.create(null),p=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?m:globalThis),b=new Proxy(m,{get(e,t){return p()[t]??m[t]},has(e,t){let s=p();return t in s||t in m},set(e,t,s){let i=p(!0);return i[t]=s,!0},deleteProperty(e,t){if(!t)return!1;let s=p(!0);return delete s[t],!0},ownKeys(){let e=p(!0);return Object.keys(e)}});function $(e){return e?e!=="false":!1}var L=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var me=L==="test"||$(b.TEST);var Fe=require("nanostores");var Ae=require("@better-fetch/fetch");var z=require("nanostores");var Te=require("@better-fetch/fetch"),d=require("nanostores"),c=(e,t,s,i)=>{let n=(0,d.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),o=()=>{let r=typeof i=="function"?i({data:n.get().data,error:n.get().error,isPending:n.get().isPending}):i;return s(t,{...r,async onSuccess(u){typeof window<"u"&&n.set({data:u.data,error:null,isPending:!1,isRefetching:!1}),await r?.onSuccess?.(u)},async onError(u){n.set({error:u.error,data:null,isPending:!1,isRefetching:!1}),await r?.onError?.(u)},async onRequest(u){let f=n.get();n.set({isPending:f.data===null,data:f.data,error:null,isRefetching:!0}),await r?.onRequest?.(u)}})};e=Array.isArray(e)?e:[e];let a=!1;for(let r of e)r.subscribe(()=>{a?o():(0,d.onMount)(n,()=>(o(),a=!0,()=>{n.off(),r.off()}))});return n};var Ce={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY};var D=e=>{let t=(0,g.atom)(!1),s=(0,g.atom)(!1),i=(0,g.atom)(!1),n={admin:S,member:R,owner:T,...e?.roles};return{id:"organization",$InferServerPlugin:{},getActions:o=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{}},organization:{checkRolePermission:a=>{let r=n[a.role];return r?(r?.authorize(a.permission)).success:!1}}}),getAtoms:o=>{let a=c(t,"/organization/list",o,{method:"GET"}),r=c([s],"/organization/get-full-organization",o,()=>({method:"GET"})),u=c([i],"/organization/get-active-member",o,{method:"GET"});return{$listOrg:t,$activeOrgSignal:s,$activeMemberSignal:i,activeOrganization:r,listOrganizations:a,activeMember:u}},pathMethods:{"/organization/get-full-organization":"GET"},atomListeners:[{matcher(o){return o==="/organization/create"||o==="/organization/delete"},signal:"$listOrg"},{matcher(o){return o.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(o){return o.includes("/organization/update-member-role")},signal:"$activeMemberSignal"}]}};var G=()=>({id:"username",$InferServerPlugin:{}});var l=require("@simplewebauthn/browser");var x=require("nanostores"),w=(e,{$listPasskeys:t})=>({signIn:{passkey:async(n,o)=>{let a=await e("/passkey/generate-authenticate-options",{method:"POST",body:{email:n?.email}});if(!a.data)return a;try{let r=await(0,l.startAuthentication)(a.data,n?.autoFill||!1),u=await e("/passkey/verify-authentication",{body:{response:r},...n?.fetchOptions,...o,method:"POST"});if(!u.data)return u}catch{return{data:null,error:{message:"auth cancelled",status:400,statusText:"BAD_REQUEST"}}}}},passkey:{addPasskey:async(n,o)=>{let a=await e("/passkey/generate-register-options",{method:"GET"});if(!a.data)return a;try{let r=await(0,l.startRegistration)(a.data),u=await e("/passkey/verify-registration",{...n?.fetchOptions,...o,body:{response:r,name:n?.name},method:"POST"});if(!u.data)return u;t.set(Math.random())}catch(r){return r instanceof l.WebAuthnError?r.code==="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"?{data:null,error:{message:"previously registered",status:400,statusText:"BAD_REQUEST"}}:r.code==="ERROR_CEREMONY_ABORTED"?{data:null,error:{message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:r.message,status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:r instanceof Error?r.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}}},$Infer:{}}),M=()=>{let e=(0,x.atom)();return{id:"passkey",$InferServerPlugin:{},getActions:t=>w(t,{$listPasskeys:e}),getAtoms(t){return{listPasskeys:c(e,"/passkey/list-user-passkeys",t,{method:"GET"}),$listPasskeys:e}},pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher(t){return t==="/passkey/verify-registration"||t==="/passkey/delete-passkey"||t==="/passkey/update-passkey"},signal:"_listPasskeys"}]}};var j=e=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:t=>t.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(t){t.data?.twoFactorRedirect&&e?.onTwoFactorRedirect&&await e.onTwoFactorRedirect()}}}]});var q=()=>({id:"magic-link",$InferServerPlugin:{}});var W=()=>({id:"phoneNumber",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/phone-number/update"||e==="/phone-number/verify"},signal:"$sessionSignal"}]});var V=()=>({id:"anonymous",$InferServerPlugin:{},pathMethods:{"/sign-in/anonymous":"POST"}});var H=e=>({id:"additional-fields-client",$InferServerPlugin:{}});var J=()=>({id:"better-auth-client",$InferServerPlugin:{},pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}});var K=()=>({id:"generic-oauth-client",$InferServerPlugin:{}});var Q=()=>({id:"better-auth-client",$InferServerPlugin:{}});var Y=()=>({id:"multi-session",$InferServerPlugin:{},atomListeners:[{matcher(e){return e==="/multi-session/set-active"},signal:"$sessionSignal"}]});var X=()=>({id:"email-otp",$InferServerPlugin:{}});var P=!1,Z=e=>({id:"one-tap",getActions:(t,s)=>({oneTap:async(i,n)=>{if(P){console.warn("A Google One Tap request is already in progress. Please wait.");return}P=!0;try{if(typeof window>"u"||!window.document){console.warn("Google One Tap is only available in browser environments");return}let{autoSelect:o,cancelOnTapOutside:a,context:r}=i??{},u=r??e.context??"signin";await ee(),await new Promise(f=>{window.google?.accounts.id.initialize({client_id:e.clientId,callback:async C=>{await t("/one-tap/callback",{method:"POST",body:{idToken:C.credential},...i?.fetchOptions,...n}),(!i?.fetchOptions&&!n||i?.callbackURL)&&(window.location.href=i?.callbackURL??"/"),f()},auto_select:o,cancel_on_tap_outside:a,context:u}),window.google?.accounts.id.prompt()})}catch(o){throw console.error("Error during Google One Tap flow:",o),o}finally{P=!1}}}),getAtoms(t){return{}}}),ee=()=>new Promise(e=>{if(window.googleScriptInitialized){e();return}let t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{window.googleScriptInitialized=!0,e()},document.head.appendChild(t)});var te=()=>O();var O=()=>({id:"infer-server-plugin",$InferServerPlugin:{}});var ne=()=>({id:"sso-client",$InferServerPlugin:{}});var re=()=>({id:"oidc-client",$InferServerPlugin:{}});0&&(module.exports={InferServerPlugin,adminClient,anonymousClient,customSessionClient,emailOTPClient,genericOAuthClient,getPasskeyActions,inferAdditionalFields,jwtClient,magicLinkClient,multiSessionClient,oidcClient,oneTapClient,organizationClient,passkeyClient,phoneNumberClient,ssoClient,twoFactorClient,usernameClient});
