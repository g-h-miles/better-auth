var b=Object.defineProperty;var e=(t,n)=>b(t,"name",{value:n,configurable:!0});import{atom as g}from"nanostores";function h(t){let n=t;return{newRole(a){return x(a)}}}e(h,"createAccessControl");function x(t){return{statements:t,authorize(n,a){for(let[i,s]of Object.entries(n)){let o=t[i];return o?(a==="OR"?s.some(r=>o.includes(r)):s.every(r=>o.includes(r)))?{success:!0}:{success:!1,error:`Unauthorized to access resource "${i}"`}:{success:!1,error:`You are not allowed to access resource: ${i}`}}return{success:!1,error:"Not authorized"}}}}e(x,"role");var w={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},d=h(w),P=d.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),O=d.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),A=d.newRole({organization:[],member:[],invitation:[]});import{createFetch as Re}from"@better-fetch/fetch";var m=Object.create(null),p=e(t=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(t?m:globalThis),"_getEnv"),S=new Proxy(m,{get(t,n){return p()[n]??m[n]},has(t,n){let a=p();return n in a||n in m},set(t,n,a){let i=p(!0);return i[n]=a,!0},deleteProperty(t,n){if(!n)return!1;let a=p(!0);return delete a[n],!0},ownKeys(){let t=p(!0);return Object.keys(t)}});function C(t){return t?t!=="false":!1}e(C,"toBoolean");var B=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var V=B==="test"||C(S.TEST);import"nanostores";import"@better-fetch/fetch";import{atom as le}from"nanostores";import"@better-fetch/fetch";import{atom as v,onMount as E}from"nanostores";var l=e((t,n,a,i)=>{let s=v({data:null,error:null,isPending:!0,isRefetching:!1}),o=e(()=>{let r=typeof i=="function"?i({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):i;return a(n,{...r,async onSuccess(c){typeof window<"u"&&s.set({data:c.data,error:null,isPending:!1,isRefetching:!1}),await r?.onSuccess?.(c)},async onError(c){s.set({error:c.error,data:null,isPending:!1,isRefetching:!1}),await r?.onError?.(c)},async onRequest(c){let f=s.get();s.set({isPending:f.data===null,data:f.data,error:null,isRefetching:!0}),await r?.onRequest?.(c)}})},"fn");t=Array.isArray(t)?t:[t];let u=!1;for(let r of t)r.subscribe(()=>{u?o():E(s,()=>(o(),u=!0,()=>{s.off(),r.off()}))});return s},"useAuthQuery");var de={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY};var Xe=e(t=>{let n=g(!1),a=g(!1),i=g(!1),s={admin:P,member:A,owner:O,...t?.roles};return{id:"organization",$InferServerPlugin:{},getActions:e(o=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{}},organization:{checkRolePermission:e(u=>{let r=s[u.role];return r?(r?.authorize(u.permission)).success:!1},"checkRolePermission")}}),"getActions"),getAtoms:e(o=>{let u=l(n,"/organization/list",o,{method:"GET"}),r=l([a],"/organization/get-full-organization",o,()=>({method:"GET"})),c=l([i],"/organization/get-active-member",o,{method:"GET"});return{$listOrg:n,$activeOrgSignal:a,$activeMemberSignal:i,activeOrganization:r,listOrganizations:u,activeMember:c}},"getAtoms"),pathMethods:{"/organization/get-full-organization":"GET"},atomListeners:[{matcher(o){return o==="/organization/create"||o==="/organization/delete"},signal:"$listOrg"},{matcher(o){return o.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(o){return o.includes("/organization/update-member-role")},signal:"$activeMemberSignal"}]}},"organizationClient");var tt=e(()=>({id:"username",$InferServerPlugin:{}}),"usernameClient");import{WebAuthnError as k,startAuthentication as I,startRegistration as _}from"@simplewebauthn/browser";import{atom as U}from"nanostores";var F=e((t,{$listPasskeys:n})=>({signIn:{passkey:e(async(s,o)=>{let u=await t("/passkey/generate-authenticate-options",{method:"POST",body:{email:s?.email}});if(!u.data)return u;try{let r=await I(u.data,s?.autoFill||!1),c=await t("/passkey/verify-authentication",{body:{response:r},...s?.fetchOptions,...o,method:"POST"});if(!c.data)return c}catch{return{data:null,error:{message:"auth cancelled",status:400,statusText:"BAD_REQUEST"}}}},"signInPasskey")},passkey:{addPasskey:e(async(s,o)=>{let u=await t("/passkey/generate-register-options",{method:"GET"});if(!u.data)return u;try{let r=await _(u.data),c=await t("/passkey/verify-registration",{...s?.fetchOptions,...o,body:{response:r,name:s?.name},method:"POST"});if(!c.data)return c;n.set(Math.random())}catch(r){return r instanceof k?r.code==="ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"?{data:null,error:{message:"previously registered",status:400,statusText:"BAD_REQUEST"}}:r.code==="ERROR_CEREMONY_ABORTED"?{data:null,error:{message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:r.message,status:400,statusText:"BAD_REQUEST"}}:{data:null,error:{message:r instanceof Error?r.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}},"registerPasskey")},$Infer:{}}),"getPasskeyActions"),at=e(()=>{let t=U();return{id:"passkey",$InferServerPlugin:{},getActions:e(n=>F(n,{$listPasskeys:t}),"getActions"),getAtoms(n){return{listPasskeys:l(t,"/passkey/list-user-passkeys",n,{method:"GET"}),$listPasskeys:t}},pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher(n){return n==="/passkey/verify-registration"||n==="/passkey/delete-passkey"||n==="/passkey/update-passkey"},signal:"_listPasskeys"}]}},"passkeyClient");var lt=e(t=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:e(n=>n.startsWith("/two-factor/"),"matcher"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(n){n.data?.twoFactorRedirect&&t?.onTwoFactorRedirect&&await t.onTwoFactorRedirect()}}}]}),"twoFactorClient");var mt=e(()=>({id:"magic-link",$InferServerPlugin:{}}),"magicLinkClient");var yt=e(()=>({id:"phoneNumber",$InferServerPlugin:{},atomListeners:[{matcher(t){return t==="/phone-number/update"||t==="/phone-number/verify"},signal:"$sessionSignal"}]}),"phoneNumberClient");var Ot=e(()=>({id:"anonymous",$InferServerPlugin:{},pathMethods:{"/sign-in/anonymous":"POST"}}),"anonymousClient");var Tt=e(t=>({id:"additional-fields-client",$InferServerPlugin:{}}),"inferAdditionalFields");var xt=e(()=>({id:"better-auth-client",$InferServerPlugin:{},pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}}),"adminClient");var Bt=e(()=>({id:"generic-oauth-client",$InferServerPlugin:{}}),"genericOAuthClient");var kt=e(()=>({id:"better-auth-client",$InferServerPlugin:{}}),"jwtClient");var Ut=e(()=>({id:"multi-session",$InferServerPlugin:{},atomListeners:[{matcher(t){return t==="/multi-session/set-active"},signal:"$sessionSignal"}]}),"multiSessionClient");var Lt=e(()=>({id:"email-otp",$InferServerPlugin:{}}),"emailOTPClient");var y=!1,Dt=e(t=>({id:"one-tap",getActions:e((n,a)=>({oneTap:e(async(i,s)=>{if(y){console.warn("A Google One Tap request is already in progress. Please wait.");return}y=!0;try{if(typeof window>"u"||!window.document){console.warn("Google One Tap is only available in browser environments");return}let{autoSelect:o,cancelOnTapOutside:u,context:r}=i??{},c=r??t.context??"signin";await $(),await new Promise(f=>{window.google?.accounts.id.initialize({client_id:t.clientId,callback:e(async R=>{await n("/one-tap/callback",{method:"POST",body:{idToken:R.credential},...i?.fetchOptions,...s}),(!i?.fetchOptions&&!s||i?.callbackURL)&&(window.location.href=i?.callbackURL??"/"),f()},"callback"),auto_select:o,cancel_on_tap_outside:u,context:c}),window.google?.accounts.id.prompt()})}catch(o){throw console.error("Error during Google One Tap flow:",o),o}finally{y=!1}},"oneTap")}),"getActions"),getAtoms(n){return{}}}),"oneTapClient"),$=e(()=>new Promise(t=>{if(window.googleScriptInitialized){t();return}let n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.defer=!0,n.onload=()=>{window.googleScriptInitialized=!0,t()},document.head.appendChild(n)}),"loadGoogleScript");var qt=e(()=>T(),"customSessionClient");var T=e(()=>({id:"infer-server-plugin",$InferServerPlugin:{}}),"InferServerPlugin");var Kt=e(()=>({id:"sso-client",$InferServerPlugin:{}}),"ssoClient");var Xt=e(()=>({id:"oidc-client",$InferServerPlugin:{}}),"oidcClient");export{T as InferServerPlugin,xt as adminClient,Ot as anonymousClient,qt as customSessionClient,Lt as emailOTPClient,Bt as genericOAuthClient,F as getPasskeyActions,Tt as inferAdditionalFields,kt as jwtClient,mt as magicLinkClient,Ut as multiSessionClient,Xt as oidcClient,Dt as oneTapClient,Xe as organizationClient,at as passkeyClient,yt as phoneNumberClient,Kt as ssoClient,lt as twoFactorClient,tt as usernameClient};
