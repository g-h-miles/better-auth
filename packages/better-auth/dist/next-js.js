var C=Object.defineProperty;var o=(e,t)=>C(e,"name",{value:t,configurable:!0});import{cookies as S}from"next/headers";var d=Object.create(null),c=o(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?d:globalThis),"_getEnv"),y=new Proxy(d,{get(e,t){return c()[t]??d[t]},has(e,t){let s=c();return t in s||t in d},set(e,t,s){let a=c(!0);return a[t]=s,!0},deleteProperty(e,t){if(!t)return!1;let s=c(!0);return delete s[t],!0},ownKeys(){let e=c(!0);return Object.keys(e)}});function M(e){return e?e!=="false":!1}o(M,"toBoolean");var x=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var $=x==="test"||M(y.TEST);import{base64Url as V}from"@better-auth/utils/base64";import{createHMAC as z}from"@better-auth/utils/hmac";function b(e){let t=new Map;return e.split(", ").forEach(a=>{let l=a.split(";").map(p=>p.trim()),[r,...u]=l,[m,...f]=r.split("="),g=f.join("=");if(!m||g===void 0)return;let i={value:g};u.forEach(p=>{let[k,...T]=p.split("="),n=T.join("="),h=k.trim().toLowerCase();switch(h){case"max-age":i["max-age"]=n?parseInt(n.trim(),10):void 0;break;case"expires":i.expires=n?new Date(n.trim()):void 0;break;case"domain":i.domain=n?n.trim():void 0;break;case"path":i.path=n?n.trim():void 0;break;case"secure":i.secure=!0;break;case"httponly":i.httponly=!0;break;case"samesite":i.samesite=n?n.trim().toLowerCase():void 0;break;default:i[h]=n?n.trim():!0;break}}),t.set(m,i)}),t}o(b,"parseSetCookieHeader");function te(e){let t=o(async s=>"handler"in e?e.handler(s):e(s),"handler");return{GET:t,POST:t}}o(te,"toNextJsHandler");var oe=o(()=>({id:"next-cookies",hooks:{after:[{matcher(e){return!0},handler:o(async e=>{let t=e.responseHeader;if(!("_flag"in e&&e._flag==="router")&&t instanceof Headers){let s=t?.get("set-cookie");if(!s)return;let a=b(s),l=await S();a.forEach((r,u)=>{if(!u)return;let m={sameSite:r.samesite,secure:r.secure,maxAge:r["max-age"],httpOnly:r.httponly,domain:r.domain,path:r.path};try{l.set(u,decodeURIComponent(r.value),m)}catch{}});return}},"handler")}]}}),"nextCookies");export{oe as nextCookies,te as toNextJsHandler};
