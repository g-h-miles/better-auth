import{cookies as M}from"next/headers";var m=Object.create(null),a=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?m:globalThis),T=new Proxy(m,{get(e,t){return a()[t]??m[t]},has(e,t){let o=a();return t in o||t in m},set(e,t,o){let i=a(!0);return i[t]=o,!0},deleteProperty(e,t){if(!t)return!1;let o=a(!0);return delete o[t],!0},ownKeys(){let e=a(!0);return Object.keys(e)}});function C(e){return e?e!=="false":!1}var y=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var w=y==="test"||C(T.TEST);import{base64Url as Y}from"@better-auth/utils/base64";import{createHMAC as q}from"@better-auth/utils/hmac";function h(e){let t=new Map;return e.split(", ").forEach(i=>{let d=i.split(";").map(l=>l.trim()),[n,...c]=d,[u,...p]=n.split("="),f=p.join("=");if(!u||f===void 0)return;let r={value:f};c.forEach(l=>{let[b,...k]=l.split("="),s=k.join("="),g=b.trim().toLowerCase();switch(g){case"max-age":r["max-age"]=s?parseInt(s.trim(),10):void 0;break;case"expires":r.expires=s?new Date(s.trim()):void 0;break;case"domain":r.domain=s?s.trim():void 0;break;case"path":r.path=s?s.trim():void 0;break;case"secure":r.secure=!0;break;case"httponly":r.httponly=!0;break;case"samesite":r.samesite=s?s.trim().toLowerCase():void 0;break;default:r[g]=s?s.trim():!0;break}}),t.set(u,r)}),t}function V(e){let t=async o=>"handler"in e?e.handler(o):e(o);return{GET:t,POST:t}}var J=()=>({id:"next-cookies",hooks:{after:[{matcher(e){return!0},handler:async e=>{let t=e.responseHeader;if(!("_flag"in e&&e._flag==="router")&&t instanceof Headers){let o=t?.get("set-cookie");if(!o)return;let i=h(o),d=await M();i.forEach((n,c)=>{if(!c)return;let u={sameSite:n.samesite,secure:n.secure,maxAge:n["max-age"],httpOnly:n.httponly,domain:n.domain,path:n.path};try{d.set(c,decodeURIComponent(n.value),u)}catch{}});return}}}]}});export{J as nextCookies,V as toNextJsHandler};
