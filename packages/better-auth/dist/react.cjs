"use strict";var E=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var n in t)E(e,n,{get:t[n],enumerable:!0})},z=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of K(t))!J.call(e,r)&&r!==n&&E(e,r,{get:()=>t[r],enumerable:!(o=G(t,r))||o.enumerable});return e};var Q=e=>z(E({},"__esModule",{value:!0}),e);var le={};X(le,{capitalizeFirstLetter:()=>q,createAuthClient:()=>ue});module.exports=Q(le);var k=require("@better-fetch/fetch");var P=Object.create(null),m=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?P:globalThis),g=new Proxy(P,{get(e,t){return m()[t]??P[t]},has(e,t){let n=m();return t in n||t in P},set(e,t,n){let o=m(!0);return o[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=m(!0);return delete n[t],!0},ownKeys(){let e=m(!0);return Object.keys(e)}});function Y(e){return e?e!=="false":!1}var Z=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var pe=Z==="test"||Y(g.TEST);var T=class extends Error{constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function ee(e){try{return new URL(e).pathname!=="/"}catch{throw new T(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function w(e,t="/api/auth"){return ee(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}function U(e,t){if(e)return w(e,t);let n=g.BETTER_AUTH_URL||g.NEXT_PUBLIC_BETTER_AUTH_URL||g.PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_BETTER_AUTH_URL||g.NUXT_PUBLIC_AUTH_URL||(g.BASE_URL!=="/"?g.BASE_URL:void 0);if(n)return w(n,t);if(typeof window<"u"&&window.location)return w(window.location.origin,t)}var _e=require("nanostores");var Se=require("@better-fetch/fetch"),I={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},x={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var B=require("nanostores");var Te=require("@better-fetch/fetch"),O=require("nanostores"),L=(e,t,n,o)=>{let r=(0,O.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),p=()=>{let l=typeof o=="function"?o({data:r.get().data,error:r.get().error,isPending:r.get().isPending}):o;return n(t,{...l,async onSuccess(f){typeof window<"u"&&r.set({data:f.data,error:null,isPending:!1,isRefetching:!1}),await l?.onSuccess?.(f)},async onError(f){r.set({error:f.error,data:null,isPending:!1,isRefetching:!1}),await l?.onError?.(f)},async onRequest(f){let c=r.get();r.set({isPending:c.data===null,data:c.data,error:null,isRefetching:!0}),await l?.onRequest?.(f)}})};e=Array.isArray(e)?e:[e];let i=!1;for(let l of e)l.subscribe(()=>{i?p():(0,O.onMount)(r,()=>(p(),i=!0,()=>{r.off(),l.off()}))});return r};function v(e){let t=(0,B.atom)(!1);return{session:L(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var te={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},ne=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,C={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},re=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function oe(e){return e instanceof Date&&!isNaN(e.getTime())}function se(e){let t=re.exec(e);if(!t)return null;let[,n,o,r,p,i,l,f,c,a,u]=t,d=new Date(Date.UTC(parseInt(n,10),parseInt(o,10)-1,parseInt(r,10),parseInt(p,10),parseInt(i,10),parseInt(l,10),f?parseInt(f.padEnd(3,"0"),10):0));if(c){let s=(parseInt(a,10)*60+parseInt(u,10))*(c==="+"?-1:1);d.setUTCMinutes(d.getUTCMinutes()+s)}return oe(d)?d:null}function ie(e,t={}){let{strict:n=!1,warnings:o=!1,reviver:r,parseDates:p=!0}=t;if(typeof e!="string")return e;let i=e.trim();if(i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);let l=i.toLowerCase();if(l.length<=9&&l in C)return C[l];if(!ne.test(i)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(te).some(([c,a])=>{let u=a.test(i);return u&&o&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${c} pattern`),u})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(a,u)=>{if(a==="__proto__"||a==="constructor"&&u&&typeof u=="object"&&"prototype"in u){o&&console.warn(`[better-json] Dropping "${a}" key to prevent prototype pollution`);return}if(p&&typeof u=="string"){let d=se(u);if(d)return d}return r?r(a,u):u})}catch(c){if(n)throw c;return e}}function F(e,t={strict:!0}){return ie(e,t)}var $=e=>{let t="credentials"in Request.prototype,n=U(e?.baseURL),o=e?.plugins?.flatMap(s=>s.fetchPlugins).filter(s=>s!==void 0)||[],r=(0,k.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",jsonParser(s){return F(s,{strict:!1})},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...o]:[I,x,...e?.fetchOptions?.plugins||[],...o]}),{$sessionSignal:p,session:i}=v(r),l=e?.plugins||[],f={},c={$sessionSignal:p,session:i},a={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},u=[{signal:"$sessionSignal",matcher(s){return s==="/sign-out"||s==="/update-user"||s.startsWith("/sign-in")||s.startsWith("/sign-up")}}];for(let s of l)s.getAtoms&&Object.assign(c,s.getAtoms?.(r)),s.pathMethods&&Object.assign(a,s.pathMethods),s.atomListeners&&u.push(...s.atomListeners);let d={notify:s=>{c[s].set(!c[s].get())},listen:(s,R)=>{c[s].subscribe(R)},atoms:c};for(let s of l)s.getActions&&Object.assign(f,s.getActions?.(r,d));return{pluginsActions:f,pluginsAtoms:c,pluginPathMethods:a,atomListeners:u,$fetch:r,$store:d}};function ae(e,t,n){let o=t[e],{fetchOptions:r,query:p,...i}=n||{};return o||(r?.method?r.method:i&&Object.keys(i).length>0?"POST":"GET")}function N(e,t,n,o,r){function p(i=[]){return new Proxy(function(){},{get(l,f){let c=[...i,f],a=e;for(let u of c)if(a&&typeof a=="object"&&u in a)a=a[u];else{a=void 0;break}return typeof a=="function"?a:p(c)},apply:async(l,f,c)=>{let a="/"+i.map(b=>b.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),u=c[0]||{},d=c[1]||{},{query:s,fetchOptions:R,...H}=u,h={...d,...R},_=ae(a,n,u);return await t(a,{...h,body:_==="GET"?void 0:{...H,...h?.body||{}},query:s||h?.query,method:_,async onSuccess(b){await h?.onSuccess?.(b);let S=r?.find(W=>W.matcher(a));if(!S)return;let A=o[S.signal];if(!A)return;let M=A.get();setTimeout(()=>{A.set(!M)},10)}})}})}return p()}var j=require("nanostores"),y=require("react"),D=(e,t)=>n=>{e.current=n,t()};function V(e,{keys:t,deps:n=[e,t]}={}){let o=(0,y.useRef)();o.current=e.get();let r=(0,y.useCallback)(i=>(t?.length||0)>0?(0,j.listenKeys)(e,t,D(o,i)):e.listen(D(o,i)),n),p=()=>o.current;return(0,y.useSyncExternalStore)(r,p,p)}function ce(e){return`use${q(e)}`}function q(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ue(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:o,$fetch:r,$store:p,atomListeners:i}=$(e),l={};for(let[a,u]of Object.entries(o))l[ce(a)]=()=>V(u);let f={...n,...l,$fetch:r,$store:p};return N(f,r,t,o,i)}0&&(module.exports={capitalizeFirstLetter,createAuthClient});
