"use strict";var T=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var r=(e,t)=>T(e,"name",{value:t,configurable:!0});var z=(e,t)=>{for(var n in t)T(e,n,{get:t[n],enumerable:!0})},Q=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of J(t))!X.call(e,o)&&o!==n&&T(e,o,{get:()=>t[o],enumerable:!(s=K(t,o))||s.enumerable});return e};var Y=e=>Q(T({},"__esModule",{value:!0}),e);var fe={};z(fe,{capitalizeFirstLetter:()=>H,createAuthClient:()=>le});module.exports=Y(fe);var $=require("@better-fetch/fetch");var O=Object.create(null),h=r(e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?O:globalThis),"_getEnv"),y=new Proxy(O,{get(e,t){return h()[t]??O[t]},has(e,t){let n=h();return t in n||t in O},set(e,t,n){let s=h(!0);return s[t]=n,!0},deleteProperty(e,t){if(!t)return!1;let n=h(!0);return delete n[t],!0},ownKeys(){let e=h(!0);return Object.keys(e)}});function Z(e){return e?e!=="false":!1}r(Z,"toBoolean");var ee=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var de=ee==="test"||Z(y.TEST);var R=class extends Error{static{r(this,"BetterAuthError")}constructor(t,n){super(t),this.name="BetterAuthError",this.message=t,this.cause=n,this.stack=""}};function te(e){try{return new URL(e).pathname!=="/"}catch{throw new R(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}r(te,"checkHasPath");function _(e,t="/api/auth"){return te(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e}${t}`)}r(_,"withPath");function I(e,t){if(e)return _(e,t);let n=y.BETTER_AUTH_URL||y.NEXT_PUBLIC_BETTER_AUTH_URL||y.PUBLIC_BETTER_AUTH_URL||y.NUXT_PUBLIC_BETTER_AUTH_URL||y.NUXT_PUBLIC_AUTH_URL||(y.BASE_URL!=="/"?y.BASE_URL:void 0);if(n)return _(n,t);if(typeof window<"u"&&window.location)return _(window.location.origin,t)}r(I,"getBaseURL");var Ce=require("nanostores");var Re=require("@better-fetch/fetch"),x={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},L={id:"add-current-url",name:"Add current URL",hooks:{onRequest(e){if(typeof window<"u"&&window.location&&window.location)try{let t=new URL(e.url);t.searchParams.set("currentURL",window.location.href),e.url=t}catch{}return e}}};var v=require("nanostores");var Ae=require("@better-fetch/fetch"),b=require("nanostores");var B=r((e,t,n,s)=>{let o=(0,b.atom)({data:null,error:null,isPending:!0,isRefetching:!1}),d=r(()=>{let f=typeof s=="function"?s({data:o.get().data,error:o.get().error,isPending:o.get().isPending}):s;return n(t,{...f,async onSuccess(p){typeof window<"u"&&o.set({data:p.data,error:null,isPending:!1,isRefetching:!1}),await f?.onSuccess?.(p)},async onError(p){o.set({error:p.error,data:null,isPending:!1,isRefetching:!1}),await f?.onError?.(p)},async onRequest(p){let u=o.get();o.set({isPending:u.data===null,data:u.data,error:null,isRefetching:!0}),await f?.onRequest?.(p)}})},"fn");e=Array.isArray(e)?e:[e];let a=!1;for(let f of e)f.subscribe(()=>{a?d():(0,b.onMount)(o,()=>(d(),a=!0,()=>{o.off(),f.off()}))});return o},"useAuthQuery");function C(e){let t=(0,v.atom)(!1);return{session:B(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}r(C,"getSessionAtom");var ne={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},re=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,F={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},oe=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function se(e){return e instanceof Date&&!isNaN(e.getTime())}r(se,"isValidDate");function ie(e){let t=oe.exec(e);if(!t)return null;let[,n,s,o,d,a,f,p,u,c,l]=t,g=new Date(Date.UTC(parseInt(n,10),parseInt(s,10)-1,parseInt(o,10),parseInt(d,10),parseInt(a,10),parseInt(f,10),p?parseInt(p.padEnd(3,"0"),10):0));if(u){let i=(parseInt(c,10)*60+parseInt(l,10))*(u==="+"?-1:1);g.setUTCMinutes(g.getUTCMinutes()+i)}return se(g)?g:null}r(ie,"parseISODate");function ae(e,t={}){let{strict:n=!1,warnings:s=!1,reviver:o,parseDates:d=!0}=t;if(typeof e!="string")return e;let a=e.trim();if(a[0]==='"'&&a.endsWith('"')&&!a.slice(1,-1).includes('"'))return a.slice(1,-1);let f=a.toLowerCase();if(f.length<=9&&f in F)return F[f];if(!re.test(a)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(ne).some(([u,c])=>{let l=c.test(a);return l&&s&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${u} pattern`),l})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(a,r((c,l)=>{if(c==="__proto__"||c==="constructor"&&l&&typeof l=="object"&&"prototype"in l){s&&console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);return}if(d&&typeof l=="string"){let g=ie(l);if(g)return g}return o?o(c,l):l},"secureReviver"))}catch(u){if(n)throw u;return e}}r(ae,"betterJSONParse");function k(e,t={strict:!0}){return ae(e,t)}r(k,"parseJSON");var N=r(e=>{let t="credentials"in Request.prototype,n=I(e?.baseURL),s=e?.plugins?.flatMap(i=>i.fetchPlugins).filter(i=>i!==void 0)||[],o=(0,$.createFetch)({baseURL:n,...t?{credentials:"include"}:{},method:"GET",jsonParser(i){return k(i,{strict:!1})},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...s]:[x,L,...e?.fetchOptions?.plugins||[],...s]}),{$sessionSignal:d,session:a}=C(o),f=e?.plugins||[],p={},u={$sessionSignal:d,session:a},c={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},l=[{signal:"$sessionSignal",matcher(i){return i==="/sign-out"||i==="/update-user"||i.startsWith("/sign-in")||i.startsWith("/sign-up")}}];for(let i of f)i.getAtoms&&Object.assign(u,i.getAtoms?.(o)),i.pathMethods&&Object.assign(c,i.pathMethods),i.atomListeners&&l.push(...i.atomListeners);let g={notify:r(i=>{u[i].set(!u[i].get())},"notify"),listen:r((i,A)=>{u[i].subscribe(A)},"listen"),atoms:u};for(let i of f)i.getActions&&Object.assign(p,i.getActions?.(o,g));return{pluginsActions:p,pluginsAtoms:u,pluginPathMethods:c,atomListeners:l,$fetch:o,$store:g}},"getClientConfig");function ce(e,t,n){let s=t[e],{fetchOptions:o,query:d,...a}=n||{};return s||(o?.method?o.method:a&&Object.keys(a).length>0?"POST":"GET")}r(ce,"getMethod");function D(e,t,n,s,o){function d(a=[]){return new Proxy(function(){},{get(f,p){let u=[...a,p],c=e;for(let l of u)if(c&&typeof c=="object"&&l in c)c=c[l];else{c=void 0;break}return typeof c=="function"?c:d(u)},apply:r(async(f,p,u)=>{let c="/"+a.map(E=>E.replace(/[A-Z]/g,P=>`-${P.toLowerCase()}`)).join("/"),l=u[0]||{},g=u[1]||{},{query:i,fetchOptions:A,...M}=l,S={...g,...A},U=ce(c,n,l);return await t(c,{...S,body:U==="GET"?void 0:{...M,...S?.body||{}},query:i||S?.query,method:U,async onSuccess(E){await S?.onSuccess?.(E);let P=o?.find(G=>G.matcher(c));if(!P)return;let w=s[P.signal];if(!w)return;let W=w.get();setTimeout(()=>{w.set(!W)},10)}})},"apply")})}return r(d,"createProxy"),d()}r(D,"createDynamicPathProxy");var V=require("nanostores"),m=require("react");var j=r((e,t)=>n=>{e.current=n,t()},"emit");function q(e,{keys:t,deps:n=[e,t]}={}){let s=(0,m.useRef)();s.current=e.get();let o=(0,m.useCallback)(a=>(t?.length||0)>0?(0,V.listenKeys)(e,t,j(s,a)):e.listen(j(s,a)),n),d=r(()=>s.current,"get");return(0,m.useSyncExternalStore)(o,d,d)}r(q,"useStore");function ue(e){return`use${H(e)}`}r(ue,"getAtomKey");function H(e){return e.charAt(0).toUpperCase()+e.slice(1)}r(H,"capitalizeFirstLetter");function le(e){let{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:s,$fetch:o,$store:d,atomListeners:a}=N(e),f={};for(let[c,l]of Object.entries(s))f[ue(c)]=()=>q(l);let p={...n,...f,$fetch:o,$store:d};return D(p,o,t,s,a)}r(le,"createAuthClient");0&&(module.exports={capitalizeFirstLetter,createAuthClient});
